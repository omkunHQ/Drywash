<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Laundry Software</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
<style>
/* ======================================= */
/* 1. GLOBAL VARIABLES & RESET             */
/* ======================================= */
:root {
    /* ब्रांड के मुख्य रंग */
    --primary-red: #F1416C;
    --primary-red-light: #FFF5F8;
    --primary-orange: #FFA500;       /* नारंगी */
    --primary-orange-light: #FFF3E0;

    /* लेआउट के रंग */
    --sidebar-bg: #ffffff;
    --main-bg: #F5F8FA;
    --card-bg: #ffffff;
    
    /* टेक्स्ट के रंग */
    --text-dark: #181C32;
    --text-light: #A1A5B7;
    --border-color: #EFF2F5;

    /* == यहाँ आपकी गड़बड़ी थी == */
    /* == यह नए रंग हैं == */
    --warning-yellow: #FFB822;
    --warning-yellow-light: #FFF9E5;
    --info-blue: #3699FF;
    --info-blue-light: #E1F0FF;
    --primary-purple: #8950FC;
    --primary-purple-light: #F3F0FF;
    --success-green: #50CD89;
    --success-green-light: #E8FFF3;
    --secondary-pink: #E11A8B;
    --secondary-pink-light: #FFF5FA;
    /* == नए रंग यहाँ खत्म होते हैं == */

    /* स्टेटस के रंग */
    --status-pending-bg: #F5F8FA;
    --status-pending-text: #A1A5B7;
    --status-active-bg: #E8FFF3;
    --status-active-text: #50CD89;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

body {
    background-color: var(--main-bg); /* नया बैकग्राउंड */
    color: var(--text-dark); /* नया टेक्स्ट रंग */
    display: flex;
}

/* ======================================= */
/* 2. LAYOUT (SIDEBAR & MAIN)              */
/* ======================================= */
.sidebar {
    width: 240px;
    background-color: var(--sidebar-bg); /* सफेद */
    color: var(--text-light);
    height: 100vh;
    position: fixed;
    left: 0;
    top: 0;
    display: none; /* Mobile-first: hidden */
    flex-direction: column;
    z-index: 1001;
    transition: transform 0.3s ease;
    border-right: 1px solid var(--border-color); /* नई बॉर्डर */
}
.sidebar-header {
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid var(--border-color); /* बॉर्डर का रंग बदला */
}
.sidebar-header i { font-size: 1.8rem; color: var(--primary-orange); }
.sidebar-header h2 { font-size: 1.2rem; color: var(--text-dark); } /* डार्क टेक्स्ट */

.sidebar-nav {
    flex-grow: 1;
    list-style: none;
    padding: 20px 10px;
}
.sidebar-nav li a {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    text-decoration: none;
    color: var(--text-light); /* हल्का टेक्स्ट */
    border-radius: 6px;
    margin-bottom: 5px;
    font-weight: 500;
    border-left: 4px solid transparent; /* एक्टिव के लिए जगह */
}
.sidebar-nav li a:hover {
    background-color: var(--primary-red-light);
    color: var(--primary-orange);
}
.sidebar-nav li.active a {
    background-color: var(--primary-orange-light);
    color: var(--primary-orange);
    font-weight: 600;
    border-left: 4px solid var(--primary-orange);
    padding-left: 11px; /* पैडिंग एडजस्ट */
}
.sidebar-nav li a i { width: 20px; text-align: center; }

/* Mobile sidebar visibility */
.sidebar.open {
    display: flex;
    transform: translateX(0);
}

.main-container {
    width: 100%;
    transition: margin-left 0.3s ease;
}

.main-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background-color: var(--card-bg); /* सफेद */
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 1000;
}
.header-left { display: flex; align-items: center; gap: 1rem; }
.header-left .menu-toggle { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--text-dark); }
.header-left h1 { font-size: 1.25rem; color: var(--text-dark); }
.search-bar { display: none; }
.header-right { display: flex; align-items: center; gap: 1.5rem; }
.header-right i { font-size: 1.2rem; color: var(--text-light); cursor: pointer; }
.user-avatar { width: 36px; height: 36px; border-radius: 50%; background-color: #ccc; }

.content-area {
    padding: 1.5rem;
    padding-bottom: 90px; /* For mobile nav */
}

/* ======================================= */
/* 3. MOBILE BOTTOM NAV                    */
/* ======================================= */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 70px;
    background-color: var(--card-bg);
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 1000;
}
.nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-light); font-size: 0.75rem; }
.nav-item i { font-size: 1.25rem; }
.nav-item.active { color: var(--primary-orange); }
.fab-new-order { background-color: var(--primary-orange); color: white; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-top: -30px; border: 4px solid var(--main-bg); cursor: pointer; text-decoration: none; }

/* ======================================= */
/* 4. REUSABLE COMPONENTS                  */
/* ======================================= */
/* Page Header */
.page-header {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--text-dark);
}
.page-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}
.page-actions .search-box {
    display: flex;
    align-items: center;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 0 10px;
}
.page-actions .search-box i { color: var(--text-light); }
.page-actions .search-box input {
    border: none;
    outline: none;
    padding: 10px;
    font-size: 0.9rem;
    background: none;
}

/* Buttons */
.btn {
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
}
.btn-primary {
    background-color: var(--primary-orange); /* लाल */
    color: white;
}
.btn-secondary {
    background-color: var(--card-bg);
    color: var(--text-dark);
    border: 1px solid var(--border-color);
}

/* Table */
.table-container {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow-x: auto;
    width: 100%; 
}

/* नया टेबल हेडर */
.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
}
.table-header h2 {
    font-size: 1.1rem;
    color: var(--text-dark);
}
.table-header i {
    color: var(--text-light);
    cursor: pointer;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}
.data-table th, .data-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.9rem;
}
.data-table th { color: var(--text-light); font-weight: 600; }
.data-table td { color: var(--text-dark); }
.data-table tr:last-child td { border-bottom: none; }

/* नए स्टेटस बैज */
.status-badge {
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}
.status-badge.pending {
    background-color: var(--status-pending-bg);
    color: var(--status-pending-text);
}
.status-badge.active { /* 'ready' को 'active' से बदल दिया */
    background-color: var(--status-active-bg);
    color: var(--status-active-text);
}
/* आप 'processing' के लिए भी स्टाइल जोड़ सकते हैं */
.status-badge.processing {
    background-color: var(--info-blue-light);
    color: var(--info-blue);
}


/* Modal */
.modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1002;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
}
.modal-content {
    background-color: var(--main-bg); /* हल्का ग्रे */
    margin: 10% auto;
    padding: 20px;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
    margin-bottom: 20px;
}
.modal-header h2 { font-size: 1.2rem; }
.modal-header .close-btn { font-size: 1.5rem; cursor: pointer; color: var(--text-light); }
.form-group { margin-bottom: 15px; }
.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    font-size: 0.9rem;
}
.form-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 0.9rem;
    background: var(--card-bg);
}

/* ======================================= */
/* 5. PAGE-SPECIFIC STYLES                 */
/* ======================================= */

/* ============= Start Dasboard================ */

/* यह नया ग्रिड है जो सभी 6 कार्ड्स को रखेगा */
.stats-grid-new {
    display: grid;
    grid-template-columns: 1fr; /* मोबाइल पर 1 कॉलम */
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

/* यह नए रंगीन कार्ड का स्टाइल है */
.stat-card-new {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    background: var(--card-bg); /* सफेद */
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.01);
}

/* यह आइकन के रंगीन गोले का स्टाइल है */
.icon-container {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
}

/* यह कार्ड के टेक्स्ट का स्टाइल है */
.stat-info .stat-title {
    color: var(--text-light); /* हल्का ग्रे टेक्स्ट */
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.stat-info .stat-number {
    color: var(--text-dark); /* गहरा (काला) टेक्स्ट */
    font-size: 2rem;
    font-weight: 700;
}

/* यह पुराने काले कार्ड्स को छिपा देगा */
.stats-grid, .stat-card, .small-stats-grid { 
    display: none !important; 
}

.quick-actions-grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 1rem; 
}
.action-card { 
    background: var(--card-bg); 
    border: 1px solid var(--border-color); 
    border-radius: 12px; 
    padding: 1.5rem 1rem; 
    text-align: center; 
    cursor: pointer; 
    transition: box-shadow 0.2s; 
    text-decoration: none;
    color: var(--text-dark);
}
.action-card:hover { box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
.action-card i { font-size: 2rem; color: var(--primary-orange); margin-bottom: 0.75rem; }
.action-card span { font-size: 0.9rem; font-weight: 500; }

/* यह लाइन ज़रूरी है: डेस्कटॉप कंटेंट को मोबाइल पर छिपाएं */
.desktop-content { display: none; } 
/* यह लाइन भी ज़रूरी है: मोबाइल क्विक एक्शन को मोबाइल पर दिखाएं (JS इसे हैंडल करता है, पर यहाँ भी रख सकते हैं) */
.mobile-only-quick-actions { display: block; } /* या इसे JS पर छोड़ दें */

/* ============= End Dasboard================ */



/* ============= Start POS ================ */
.pos-layout { display: flex; flex-direction: column; gap: 1.5rem; }
.product-filters { display: flex; gap: 10px; margin-bottom: 1rem; overflow-x: auto; padding-bottom: 5px; }
.filter-btn { background: var(--card-bg); border: 1px solid var(--border-color); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; white-space: nowrap; }
.filter-btn.active { background: var(--primary-orange); color: white; border-color: var(--primary-orange); }
.product-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
.product-card { padding: 1rem; text-align: center; }
.product-card i { font-size: 2rem; color: var(--primary-orange); margin-bottom: 0.5rem; }
.product-card .name { font-weight: 600; font-size: 0.9rem; }
.product-card .price { font-size: 0.85rem; color: var(--text-light); }
.pos-cart { width: 100%; }
.cart-container { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; position: sticky; top: 85px; }
.cart-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color); font-size: 1.1rem; font-weight: 600; }
.customer-details { padding: 1.5rem; border-bottom: 1px solid var(--border-color); }
.customer-details input { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; margin-bottom: 10px; }
.cart-items-list { padding: 1rem 1.5rem; max-height: 300px; overflow-y: auto; }
.cart-item { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
.cart-item-details .name { font-weight: 500; }
.cart-item-details .price { font-size: 0.9rem; color: var(--text-light); }
.cart-item-qty { display: flex; align-items: center; gap: 8px; }
.cart-item-qty button { background: var(--main-bg); border: 1px solid var(--border-color); width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 1rem; }
.cart-item-qty .qty-value { font-weight: 500; }
.cart-item-remove { background: none; border: none; color: var(--primary-orange); font-size: 1.1rem; cursor: pointer; margin-left: 10px; }
.cart-empty-msg { text-align: center; color: var(--text-light); padding: 2rem 0; }
.cart-summary { padding: 1.5rem; border-top: 1px solid var(--border-color); }
.summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; }
.summary-row span { color: var(--text-light); }
.summary-row strong { color: var(--text-dark); }
.summary-row.total { font-size: 1.2rem; font-weight: 600; margin-top: 10px; }
.charge-btn { display: block; width: 100%; background: var(--primary-orange); color: white; padding: 1rem; border: none; border-radius: 0 0 11px 11px; font-size: 1.1rem; font-weight: 600; cursor: pointer; }

/* Custom Item Form */
.custom-item-form {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    background-color: #fdfdfe;
}
.custom-item-form h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
}
.form-row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}
.form-row .form-group {
    flex: 1;
    margin-bottom: 0;
}
.form-row .form-group.small {
    flex: 0.5;
}
/* ============= End POS ================ */


/* ======================================= */
/* 6. DESKTOP MEDIA QUERY                  */
/* ======================================= */
@media (min-width: 768px) {
    .sidebar {
        display: flex; /* Show sidebar on desktop */
        transform: translateX(0);
    }
    .main-container {
        margin-left: 240px;
        width: calc(100% - 240px);
    }
    .main-header .menu-toggle { display: none; }
    .header-left h1 { display: block; } /* हेडर टाइटल दिखाएँ */
    .search-bar { 
        display: flex; 
        align-items: center; 
        background-color: var(--main-bg); 
        border-radius: 8px; 
        padding: 5px 10px; 
        width: 300px; 
        border: 1px solid var(--border-color);
    }
    .search-bar i { color: var(--text-light); }
    .search-bar input { border: none; background: none; outline: none; padding: 5px 8px; font-size: 0.9rem; }
    .bottom-nav { display: none; }
    .content-area { padding: 2rem; }

    /* ============= Start Desktop Dasboard Layout Only ================ */

    /* 1. कार्ड्स को 3 कॉलम में करें */
    #page-dashboard .stats-grid-new { /* सिर्फ डैशबोर्ड पेज पर */
        grid-template-columns: repeat(3, 1fr); 
    }

    /* 2. मुख्य रो को फ्लेक्स बनाएं */
    #page-dashboard .dashboard-main-row {
        display: flex !important; /* Force display flex */
        gap: 1.5rem; 
        align-items: flex-start; 
        margin-top: 1.5rem; 
        flex-direction: column;
    }

    /* 3. बायाँ कॉलम (क्विक एक्शन) */
    #page-dashboard .quick-actions-column {
        width: 100%;
        display: block !important; /* Ensure it's visible */
    }

    #page-dashboard .quick-actions-column h2 {
         margin-bottom: 1rem; 
         font-size: 1.1rem;
         color: var(--text-dark);
    }
    #page-dashboard .quick-actions-grid-vertical {
        display: grid;
        gap: 1rem; 
        grid-template-columns: repeat(3, 1fr); /* <-- YAH ADD KAREIN */
    }
     #page-dashboard .quick-actions-grid-vertical .action-card {
        flex-direction: row;
        text-align: left;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
     #page-dashboard .quick-actions-grid-vertical .action-card i {
        margin-bottom: 0;
        font-size: 1.5rem; 
        width: 30px; 
        text-align: center;
    }


    /* 4. दायाँ कॉलम (टेबल + ग्राफ) */
    #page-dashboard .table-graph-column {
        flex: 1; /* बची हुई सारी जगह ले लो */
        display: flex !important; /* Force display flex */
        flex-direction: column; 
        gap: 1.5rem; 
        min-width: 0; 
    }

    /* 5. टेबल कंटेनर */
     #page-dashboard .table-container {
         width: 100%;
         /* Styles from outside media query apply here */
     }

    /* 6. डेटा टेबल */
     #page-dashboard .data-table {
         width: 100%;
         /* Styles from outside media query apply here */
     }

    /* 7. ग्राफ कंटेनर */
    #page-dashboard .chart-container {
        width: 100%; 
        height: 350px; 
        position: relative; 
        padding: 0; 
        margin: 0;
        background: var(--card-bg); /* Ensure background is applied */
         border: 1px solid var(--border-color); /* Ensure border */
         border-radius: 12px; /* Ensure radius */
    }
    /* ग्राफ टाइटल */
    #page-dashboard .chart-container h2 {
        padding: 1.5rem 1.5rem 0 1.5rem; 
        margin-bottom: 1rem; 
        font-size: 1.1rem;
        color: var(--text-dark);
    }

    /* 8. कैनवास (ग्राफ) */
    #page-dashboard #weeklyChart {
        display: block; 
        width: 100% !important; 
        max-width: 100%;
        height: auto !important; 
        box-sizing: border-box; 
        padding: 0 1rem 1.5rem 1rem; 
        margin: 0 !important; 
    }

    /* 9. डेस्कटॉप कंटेंट दिखाएं, मोबाइल छिपाएं */
     #page-dashboard .desktop-content {
        display: block !important; 
    }
     #page-dashboard .mobile-only-quick-actions {
         display: none !important;
     }

    /* ============= End Desktop Dasboard Layout Only ================ */

    /* ============= Start Desktop POS ================ */
.pos-layout { 
    flex-direction: row; 
    align-items: flex-start; 
    gap: 1.5rem; /* Optional: Dono ke beech space dega */
}

/* YEH NAYA RULE ADD KAREIN */
.pos-products {
    flex: 1;  /* Yeh products ko bachi hui poori jagah dega */
    min-width: 0; /* Yeh flexbox ko ajeeb tarah se shrink/overflow hone se rokta hai */
}

.pos-cart { 
    width: 400px; /* <-- Yahaan apni pasand ki width rakhein (jaise 450px ya 500px) */
    flex-shrink: 0; /* <-- YEH SABSE ZAROORI HAI: Yeh cart ko sikudne se rokega */
} 
.product-grid { 
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); /* <-- minmax(130px, 1fr) ko minmax(90px, 1fr) kiya */
    gap: 0.75rem; /* Optional: Items ke beech thoda kam space */
}
/* ============= End Desktop POS ================ */
}

/* ============= Start Cash Register ================ */
.cash-summary-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* Mobile par 2 column */
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.cash-summary-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.01);
}

.cash-summary-card .title {
    color: var(--text-light);
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.cash-summary-card .amount {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
}

.cash-summary-card .amount.positive {
    color: var(--success-green);
}

.cash-summary-card .amount.negative {
    color: var(--primary-red);
}

/* Desktop par 4 column */
@media (min-width: 768px) {
    .cash-summary-grid {
        grid-template-columns: repeat(4, 1fr);
    }
}
/* ============= End Cash Register ================ */

/* ============= Start Order Details Modal ================ */
.modal-content.modal-lg {
    max-width: 700px; /* Bada modal */
}

.order-details-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
}
.order-details-header h3 {
    font-size: 1.25rem;
    color: var(--text-dark);
}
/* Order ID */
.order-details-header h3 span {
    font-size: 1rem;
    font-weight: 500;
    color: var(--text-light);
    margin-left: 8px;
}

.order-details-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}
.order-info-box {
    background: var(--main-bg);
    border-radius: 8px;
    padding: 1rem;
}
.order-info-box h4 {
    font-size: 1rem;
    color: var(--text-dark);
    margin-bottom: 0.75rem;
}
.order-info-box p {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 0.5rem;
    line-height: 1.4;
}
.order-info-box p strong {
    color: var(--text-dark);
    font-weight: 500;
}

.order-items-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
}
.order-items-table th, .order-items-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.9rem;
}
.order-items-table th {
    background-color: var(--main-bg);
    color: var(--text-light);
}
.order-items-table td.item-price {
    text-align: right;
    font-weight: 500;
}

.order-details-summary {
    width: 50%;
    margin-left: auto; /* Right align */
    margin-bottom: 1.5rem;
}
.summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9rem;
}
.summary-row.total {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-dark);
    border-top: 1px solid var(--border-color);
    padding-top: 8px;
    margin-top: 8px;
}
.summary-row span { color: var(--text-light); }
.summary-row strong { color: var(--text-dark); }

.order-status-updater {
    border-top: 1px solid var(--border-color);
    padding-top: 1.5rem;
}
.order-status-updater h4 {
    font-size: 1rem;
    margin-bottom: 1rem;
}
.status-buttons {
    display: flex;
    gap: 10px;
}
.status-buttons .btn {
    flex: 1;
}
/* ============= End Order Details Modal ================ */

/* ============= StartSchedule Modal ================ */
.fc-toolbar-title { font-size: 1.5rem !important; color: var(--text-dark); }
        .fc-button { 
            background-color: var(--primary-orange) !important; 
            border: none !important; 
            box-shadow: none !important;
        }
        .fc-button:focus { box-shadow: none !important; }
        .fc-daygrid-day-number { color: var(--text-light); }
        .fc-day-today { background-color: var(--primary-orange-light) !important; }
        
        /* ======================================= */
/* 7. SCHEDULE PAGE MOBILE FIX             */
/* ======================================= */

/* 1. Page Header ko wrap karne dein */
#page-schedule .page-header {
    flex-wrap: wrap;
    gap: 1rem;
}

/* 2. 'Optimize Route' card ko vertical stack karein */
#page-schedule .page-actions {
    flex-direction: column;
    align-items: stretch; /* Dropdown aur Button full-width honge */
    gap: 1rem;
}

/* 3. Calendar ke poore header ko vertical stack karein */
#page-schedule .fc-toolbar.fc-header-toolbar {
    flex-direction: column; /* Prev/Next, Title, Views ko stack karein */
    gap: 1.25rem;
    align-items: center;
}

/* 4. Calendar ke title ('October 2025') ka size chhota karein */
#page-schedule .fc-toolbar-title {
    font-size: 1.25rem !important; 
}

/* 5. Calendar ke din (Mon, Tue) ke text ko chhota karein */
#page-schedule .fc-col-header-cell-cushion {
    font-size: 0.8rem;
    padding: 5px;
}
/* ============= End Schedule Modal ================ */
</style>
	</head>
<body>
     <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fa-solid fa-shirt"></i>
            <h2>Laundry Soft.</h2>
        </div>
        <ul class="sidebar-nav" id="sidebar-nav-list">
            <li class="active"><a href="#dashboard" data-page="page-dashboard"><i class="fa-solid fa-tachometer-alt"></i> Dashboard</a></li>
            <li><a href="#pos" data-page="page-pos"><i class="fa-solid fa-cash-register"></i> POS</a></li>
            <li><a href="#orders" data-page="page-orders"><i class="fa-solid fa-box-archive"></i> Orders</a></li>
            <li><a href="#schedule" data-page="page-schedule"><i class="fa-solid fa-calendar-alt"></i> Schedule</a></li>
            <li><a href="#cash-register" data-page="page-cash-register"><i class="fa-solid fa-calculator"></i> Cash Register</a></li>
            <li><a href="#customers" data-page="page-customers"><i class="fa-solid fa-users"></i> Customers</a></li>
            <li><a href="#reports" data-page="page-reports"><i class="fa-solid fa-chart-bar"></i> Reports</a></li>
            <li><a href="#inventory" data-page="page-inventory"><i class="fa-solid fa-dolly"></i> Inventory</a></li>
            <li><a href="#staff" data-page="page-staff"><i class="fa-solid fa-users-gear"></i> Staff</a></li>
            <li><a href="#settings" data-page="page-settings"><i class="fa-solid fa-cogs"></i> Settings</a></li>
            <li style="margin-top: 20px;"><a href="#" id="logout-btn" style="color: var(--primary-red);"><i class="fa-solid fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </nav>

    <div class="main-container">

        <header class="main-header">
            <div class="header-left">
                <button class="menu-toggle" id="menu-toggle-btn">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <h1 id="page-title-header">Dashboard</h1> <div class="search-bar">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" placeholder="Search...">
                </div>
            </div>
            <div class="header-right">
                <i class="fa-regular fa-bell"></i>
                <div class="user-avatar"></div>
            </div>
        </header>

        <! =============== PAGE 1: Dasboard Start ==================== !>
        <main class="content-area page-content" id="page-dashboard">

            <div class="stats-grid-new">
                <div class="stat-card-new">
                    <div class="icon-container" style="background-color: var(--primary-red-light);">
                        <i class="fa-solid fa-list-check" style="color: var(--primary-red);"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-title">Today's Orders</div>
                        <div class="stat-number" id="stats-today-orders">15</div>
                    </div>
                </div>
                <div class="stat-card-new">
                    <div class="icon-container" style="background-color: var(--warning-yellow-light);">
                        <i class="fa-solid fa-clock" style="color: var(--warning-yellow);"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-title">Total Pending</div>
                        <div class="stat-number" id="stats-pending">03</div>
                    </div>
                </div>
                <div class="stat-card-new">
                    <div class="icon-container" style="background-color: var(--info-blue-light);">
                        <i class="fa-solid fa-truck" style="color: var(--info-blue);"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-title">Total Delivered</div>
                        <div class="stat-number" id="stats-delivered">180</div>
                    </div>
                </div>
                <div class="stat-card-new">
                    <div class="icon-container" style="background-color: var(--primary-purple-light);">
                        <i class="fa-solid fa-users" style="color: var(--primary-purple);"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-title">Total Customers</div>
                        <div class="stat-number" id="stats-customers">390</div>
                    </div>
                </div>
                <div class="stat-card-new">
                    <div class="icon-container" style="background-color: var(--success-green-light);">
                        <i class="fa-solid fa-wallet" style="color: var(--success-green);"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-title">Unpaid Orders</div>
                        <div class="stat-number" id="stats-unpaid">0</div>
                    </div>
                </div>
                <div class="stat-card-new">
                    <div class="icon-container" style="background-color: var(--secondary-pink-light);">
                        <i class="fa-solid fa-map-location-dot" style="color: var(--secondary-pink);"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-title">Total Pickup Req..</div>
                        <div class="stat-number" id="stats-pickup">44</div>
                    </div>
                </div>
            </div> <div class="dashboard-main-row desktop-content">

                <div class="quick-actions-column">
                    <h2>Quick Actions</h2>
                    <div class="quick-actions-grid-vertical">
                         <a href="#pos" data-page="page-pos" class="action-card quick-action-link">
                             <i class="fa-solid fa-plus" style="color: var(--info-blue);"></i>
                             <span>New Order</span>
                         </a>
                         <a href="#orders" data-page="page-orders" class="action-card quick-action-link">
                             <i class="fa-solid fa-boxes-stacked" style="color: var(--primary-purple);"></i>
                             <span>Manage Orders</span>
                         </a>
                         <a href="#pos" data-page="page-pos" class="action-card quick-action-link">
                             <i class="fa-solid fa-cash-register" style="color: var(--success-green);"></i>
                             <span>Cash Register</span>
                         </a>
                    </div>
                </div>

                <div class="table-graph-column">
                    <div class="table-container">
                        <div class="table-header">
                            <h2>Today's Orders (18 Aug 2022)</h2>
                            <i class="fa-solid fa-ellipsis-vertical"></i>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Invoice</th>
                                    <th>Customer Name</th>
                                    <th>Delivery Date</th>
                                    <th>Qty</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body">
                                 <tr>
                                     <td>INV-001</td>
                                     <td>Sarthak Kumar</td>
                                     <td>10 Apr</td>
                                     <td>5</td>
                                     <td><span class="status-badge ready active">READY</span></td>
                                 </tr>
                                 <tr>
                                     <td>INV-002</td>
                                     <td>Neha Singh</td>
                                     <td>11 Apr</td>
                                     <td>3</td>
                                     <td><span class="status-badge pending">PENDING</span></td>
                                 </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="chart-container">
                        <h2>Weekly Order Trends</h2>
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>

            </div> <div class="mobile-only-quick-actions" style="display: none;">
                 <h2>Quick Actions</h2>
                 <div class="quick-actions-grid">
                     <a href="#pos" data-page="page-pos" class="action-card quick-action-link"><i class="fa-solid fa-shirt" style="color: var(--info-blue);"></i><span>New Order</span></a>
                     <a href="#orders" data-page="page-orders" class="action-card quick-action-link"><i class="fa-solid fa-boxes-stacked" style="color: var(--primary-purple);"></i><span>Manage Orders</span></a>
                     <a href="#customers" data-page="page-customers" class="action-card quick-action-link"><i class="fa-solid fa-receipt" style="color: var(--warning-yellow);"></i><span>Customers</span></a>
                     <a href="#" class="action-card"><i class="fa-solid fa-calendar-check" style="color: var(--success-green);"></i><span>Schedule Pickup</span></a>
                 </div>
            </div>

        </main>
        <! =============== Dasboard Ending ==================== !>

        <! ================ PAGE 2: Pos Start ===================== !>
        <main class="content-area page-content" id="page-pos" style="display:none;">
    
    <div class="pos-layout">

        <section class="pos-products">
            
            <div class="product-filters" id="product-filters">
                <button class="filter-btn active" data-category="all">All</button>
                </div>
            
            <div class="product-grid" id="product-grid">
                <p>Loading products...</p>
            </div>
        </section>


        <aside class="pos-cart">
            <div class="cart-container">
                
                <div class="cart-header">Order Cart</div>
                
                <div class="customer-details">
                    <input type="tel" id="customer-phone" placeholder="Customer Phone*">
                    <input type="text" id="customer-name" placeholder="Customer Name">
                </div>
                
                <form class="custom-item-form" id="custom-item-form">
                    <h3>Add Custom/Weight Item</h3>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label for="custom-item-name">Item Name</label>
                            <input type="text" id="custom-item-name" placeholder="e.g., Wash & Fold">
                        </div>
                        <div class="form-group small">
                            <label for="custom-item-qty">Qty/Kg</label>
                            <input type="number" id="custom-item-qty" value="1" step="0.1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="custom-item-price">Price (per unit/kg)</label>
                            <input type="number" id="custom-item-price" placeholder="e.g., 70">
                        </div>
                        <button type="submit" class="btn btn-primary" style="align-self: flex-end;">Add</button>
                    </div>
                </form>
                
                <div class="cart-items-list" id="cart-items-list">
                    <div class="cart-empty-msg">Cart is empty</div>
                </div>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <strong id="summary-subtotal">$0.00</strong>
                    </div>
                    <div class="summary-row">
                        <span>Discount</span>
                        <strong id="summary-discount">$0.00</strong>
                    </div>
                    
                    <div class="summary-row" style="align-items: center; padding: 10px 15px; background: var(--warning-yellow-light);">
                        <label for="is-express-order" style="font-weight: 600; color: var(--text-dark);">Express Order (Urgent)?</label>
                        <input type="checkbox" id="is-express-order" style="width: 20px; height: 20px; accent-color: var(--primary-orange);">
                    </div>
                    
                    <div class="summary-row total">
                        <span>Total</span>
                        <strong id="summary-total">$0.00</strong>
                    </div>
                </div>
                
                <button class="charge-btn" id="place-order-btn">
                    Charge & Place Order
                </button>
            </div>
        </aside>
        
    </div>
</main>
        <! =================== Pos Ending =================== !>

        <! ================Order Start ==================== !>
        <main class="content-area page-content" id="page-orders" style="display:none;">

    <h1 class="page-header">Manage Orders</h1>
    <div class="page-actions">

        <div class="search-box">
            <i class="fa-solid fa-search"></i>
            <input type="text" id="order-search" placeholder="Search by Invoice, Name, or Phone...">
        </div>

        <a href="#pos" data-page="page-pos" class="btn btn-primary quick-action-link">
            <i class="fa-solid fa-plus"></i>
            <span>New Order</span>
        </a>

    </div>
    <div class="table-container">
        <table class="data-table">

            <thead>
                <tr>
                    <th>Invoice ID</th>
                    <th>Customer</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>

            <tbody id="orders-list-body">
                <tr>
                    <td colspan="6" style="text-align: center;">Loading orders...</td>
                </tr>
            </tbody>

        </table>
    </div>
    </main>
    <! ============ Order Ending ======================= !>
    
<! ============ Schedule Start ======================= !>
    <main class="content-area page-content" id="page-schedule" style="display:none;">
    
    <div class="page-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <span>Pickup & Delivery Schedule</span>
        <button class="btn btn-primary" id="add-schedule-event-btn">
            <i class="fa-solid fa-plus"></i>
            <span>Add New Entry</span>
        </button>
    </div>

    <div class="page-actions" style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; justify-content: space-between; flex-wrap: wrap;">
        <h3 style="margin-bottom: 1rem; width: 100%; color: var(--text-dark);">Optimize Rider's Route (Today)</h3>
        
        <div class="form-group" style="flex-grow: 1; margin-bottom: 0;">
            <label for="route-rider-select">Select Rider</label>
            <select id="route-rider-select" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; background: var(--card-bg);">
                <option value="">-- Select Rider --</option>
                </select>
        </div>
        
        <button class="btn btn-primary" id="optimize-route-btn" style="align-self: flex-end;">
            <i class="fa-solid fa-route"></i>
            <span>Show Best Route</span>
        </button>
    </div>
    <div class="table-container" style="padding: 1.5rem; background: var(--card-bg);">
        <div id="schedule-calendar"></div>
    </div>
</main>
 <! ============ Schedule End======================= !>
    
        <! =============== PAGE 8: Cash Register Start ==================== !>
        <main class="content-area page-content" id="page-cash-register" style="display:none;">
            <h1 class="page-header">Cash Register (Today's Log)</h1>

            <div class="cash-summary-grid">
                <div class="cash-summary-card">
                    <div class="title">Opening Balance</div>
                    <div class="amount" id="summary-opening">₹0.00</div>
                </div>
                <div class="cash-summary-card">
                    <div class="title">Total Cash In</div>
                    <div class="amount positive" id="summary-cash-in">₹0.00</div>
                </div>
                <div class="cash-summary-card">
                    <div class="title">Total Cash Out</div>
                    <div class="amount negative" id="summary-cash-out">₹0.00</div>
                </div>
                <div class="cash-summary-card">
                    <div class="title">Expected in Drawer</div>
                    <div class="amount" id="summary-closing">₹0.00</div>
                </div>
            </div>

            <div class="page-actions" style="justify-content: flex-end;">
                <button class="btn btn-secondary" id="set-opening-balance-btn">
                    <i class="fa-solid fa-store"></i>
                    <span>Set Opening Balance</span>
                </button>
                <button class="btn btn-primary" style="background-color: var(--success-green); border-color: var(--success-green);" id="add-cash-in-btn">
                    <i class="fa-solid fa-plus"></i>
                    <span>Add Cash In</span>
                </button>
                <button class="btn btn-primary" id="add-cash-out-btn">
                    <i class="fa-solid fa-minus"></i>
                    <span>Add Cash Out (Expense)</span>
                </button>
            </div>

            <div class="table-container">
                 <div class="table-header">
                    <h2>Today's Transactions</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="cash-log-body">
                         </tbody>
                </table>
            </div>

        </main>
        <! ============== Cash Register End ================== !>

        <! ============== PAGE 4: Coustomer Start ===================== !>
        <main class="content-area page-content" id="page-customers" style="display:none;">
            <h1 class="page-header">Customer Management</h1>
            <div class="page-actions">
                <div class="search-box">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" id="customer-search" placeholder="Search by Name or Phone...">
                </div>
                <button class="btn btn-primary" id="add-customer-btn">
                    <i class="fa-solid fa-plus"></i>
                    <span>New Customer</span>
                </button>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Total Orders</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customers-list-body">
                        <tr>
                            <td colspan="4" style="text-align: center;">Loading customers...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
        <! ============= Coustomer End ==================== !>

        <! =============== PAGE 5: Report Start ==================== !>
        <main class="content-area page-content" id="page-reports" style="display:none;">
            <h1 class="page-header">Reports</h1>
            <p style="color: var(--text-light);">This feature is coming soon.</p>
        </main>
        <! ============== Report End ================== !>

        <! =============== PAGE 6: Inventory Start ==================== !>
        <main class="content-area page-content" id="page-inventory" style="display:none;">
            <h1 class="page-header">Inventory</h1>
            <p style="color: var(--text-light);">This feature is coming soon.</p>
        </main>
        <! ============== Inventory End ================== !>

   <! =============== Staff Start ==================== !>      
       <main class="content-area page-content" id="page-staff" style="display:none;">
            <h1 class="page-header">Manage Staff (Riders)</h1>

            <div class="page-actions" style="justify-content: flex-end;">
                <button class="btn btn-primary" id="add-staff-btn">
                    <i class="fa-solid fa-plus"></i>
                    <span>Add New Rider</span>
                </button>
            </div>

            <div class="table-container">
                 <div class="table-header">
                    <h2>Current Riders</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Rider Name</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="staff-list-body">
                         </tbody>
                </table>
            </div>

        </main>
   <! =============== Staff End ==================== !>      
        
        <! =============== Settings Start ==================== !>
        <main class="content-area page-content" id="page-settings" style="display:none;">
            <h1 class="page-header">Settings</h1>
            <p style="color: var(--text-light);">This feature is coming soon.</p>
        </main>
        <! ============== Settings End ================== !>

<! =========================================== !>
<! ============== Modal Start ================== !>
<! ========================================= !>
    
    <! ============== Coustomer Model Start ================== !>
        
        <div id="customer-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">Add New Customer</h2>
                    <span class="close-btn" id="modal-close-btn">×</span>
                </div>
                <form id="customer-form">
                    <input type="hidden" id="customer-id">
                    <div class="form-group">
                        <label for="form-customer-name">Name*</label>
                        <input type="text" id="form-customer-name" required>
                    </div>
                    <div class="form-group">
                        <label for="form-customer-phone">Phone*</label>
                        <input type="text" id="form-customer-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="form-customer-address">Address</label>
                        <input type="text" id="form-customer-address">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Save Customer</button>
                </form>
            </div>
        </div>
<! ============== Coustomer Model End ================== !>
    
<! ============== Dasboard Model Start ================== !>
    <nav class="bottom-nav">
        <a href="#dashboard" class="nav-item active" data-page="page-dashboard">
            <i class="fa-solid fa-tachometer-alt"></i>
            <span>Dashboard</span>
        </a>
        <a href="#orders" class="nav-item" data-page="page-orders">
            <i class="fa-solid fa-box-archive"></i>
            <span>Orders</span>
        </a>
        
        <a href="#pos" class="fab-new-order" data-page="page-pos">
            <i class="fa-solid fa-plus"></i>
        </a>
        
        <a href="#customers" class="nav-item" data-page="page-customers">
            <i class="fa-solid fa-users"></i>
            <span>Customers</span>
        </a>
        <a href="#settings" class="nav-item" data-page="page-settings">
            <i class="fa-solid fa-cogs"></i>
            <span>Settings</span>
        </a>
    </nav>   
<! ============== Dasboard Model End ================== !>

<! ============== Cash Ragister Opening Blance Model Start ================== !>
     <div id="opening-balance-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Opening Balance</h2>
                <span class="close-btn" data-modal="opening-balance-modal">×</span>
            </div>
            <form id="opening-balance-form">
                <div class="form-group">
                    <label for="form-opening-amount">Amount in Drawer*</label>
                    <input type="number" id="form-opening-amount" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Set Balance</button>
            </form>
        </div>
    </div>

    <div id="cash-in-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Cash In</h2>
                <span class="close-btn" data-modal="cash-in-modal">×</span>
            </div>
            <form id="cash-in-form">
                <div class="form-group">
                    <label for="form-cash-in-amount">Amount Received*</label>
                    <input type="number" id="form-cash-in-amount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="form-cash-in-notes">Notes</label>
                    <input type="text" id="form-cash-in-notes" placeholder="e.g., Order INV-002 Payment">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Add Cash</button>
            </form>
        </div>
    </div>

    <div id="cash-out-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Cash Out (Expense)</h2>
                <span class="close-btn" data-modal="cash-out-modal">×</span>
            </div>
            <form id="cash-out-form">
                <div class="form-group">
                    <label for="form-cash-out-amount">Amount Spent*</label>
                    <input type="number" id="form-cash-out-amount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="form-cash-out-notes">Notes</label>
                    <input type="text" id="form-cash-out-notes" placeholder="e.g., Bought detergent">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; background-color: var(--primary-red); border-color: var(--primary-red);">Save Expense</button>
            </form>
        </div>
    </div>

<! ============== Cash Ragister Opening Blance Model End ================== !>
    
<! ============== Order Model Start ================== !>
     <div id="order-details-modal" class="modal">
        <div class="modal-content modal-lg">
            
            <div class="modal-header">
                <h2>Order Details</h2>
                <div>
                    <button class="btn btn-secondary" id="print-order-tag-btn" style="margin-right: 20px;">
                        <i class="fa-solid fa-print"></i> Print Tag
                    </button>
                    <span class="close-btn" data-modal="order-details-modal">×</span>
                </div>
            </div>
            <div id="modal-body-content" style="padding: 20px;">
            
                <div class="order-details-header">
                    <h3>Invoice <span id="modal-order-id">INV-000</span></h3>
                    <span class="status-badge" id="modal-order-status">PENDING</span>
                </div>

                <div class="order-details-layout">
                    <div class="order-info-box">
                        <h4>Customer Details</h4>
                        <p><strong>Name:</strong> <span id="modal-customer-name">N/A</span></p>
                        <p><strong>Phone:</strong> <span id="modal-customer-phone">N/A</span></p>
                        <p><strong>Address:</strong> <span id="modal-customer-address">N/A</span></p>
                    </div>
                    <div class="order-info-box">
                        <h4>Order Info</h4>
                        <p><strong>Order Date:</strong> <span id="modal-order-date">N/A</span></p>
                        <p><strong>Total Items:</strong> <span id="modal-order-total-items">0</span></p>
                        <p><strong>Payment:</strong> <strong style="color: var(--primary-red);" id="modal-order-payment">UNPAID</strong></p>
                    </div>
                </div>

                <h4>Items in this Order</h4>
                <div class="table-container" style="border-radius: 8px; margin-bottom: 1rem;">
                    <table class="order-items-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Qty</th>
                                <th class="item-price">Price</th>
                                <th class="item-price">Total</th>
                            </tr>
                        </thead>
                        <tbody id="modal-items-list">
                        </tbody>
                    </table>
                </div>

                <div class="order-details-summary">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <strong id="modal-summary-subtotal">₹0.00</strong>
                    </div>
                    <div class="summary-row">
                        <span>Discount</span>
                        <strong id="modal-summary-discount">₹0.00</strong>
                    </div>
                    <div class="summary-row total">
                        <span>Grand Total</span>
                        <strong id="modal-summary-total">₹0.00</strong>
                    </div>
                </div>
                
                <div class="order-status-updater">
                    <h4>Update Order Status</h4>
                    <div class="status-buttons" id="modal-status-buttons">
                    </div>
                </div>
            </div> 
        </div>
    </div>
<! ============== Order Model End ================== !>
 
 <! ============== schedule Model Start ================== !>
 
 <div id="schedule-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="schedule-modal-title">Add New Entry</h2>
            <span class="close-btn" data-modal="schedule-modal">×</span>
        </div>
        
        <form id="schedule-form" style="padding: 20px;">
            <input type="hidden" id="event-id">
            
            <div class="form-group">
                <label for="event-order-select">Select Order (Pickup/Delivery)</label>
                <select id="event-order-select" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; background: var(--card-bg);" required>
                    <option value="">-- Select an Order --</option>
                    </select>
            </div>
            <input type="hidden" id="event-title">

            <div class="form-group">
                <label for="event-type">Type</label>
                <select id="event-type" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; background: var(--card-bg);">
                    <option value="PICKUP">Pickup</option>
                    <option value="DELIVERY">Delivery</option>
                </select>
            </div>

            <div class="form-group">
                <label for="event-rider-select">Assign Rider</label>
                <select id="event-rider-select" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; background: var(--card-bg);">
                    <option value="">-- Unassigned --</option>
                    </select>
            </div>

            <div class="form-group">
                <label for="event-date">Date</label>
                <input type="date" id="event-date" required>
            </div>
            
            <div class="form-group">
                <label for="event-time">Time (Optional)</label>
                <input type="time" id="event-time" placeholder="HH:MM">
                <small style="color: var(--text-light);">Agar time khaali chhodenge toh yeh poore din ka event ban jaayega.</small>
            </div>
            
            <div class="form-group" style="background: var(--main-bg); padding: 15px; border-radius: 8px;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <label for="is-recurring" style="font-weight: 600; margin-bottom: 0;">Recurring Event?</label>
                    <input type="checkbox" id="is-recurring" style="width: 20px; height: 20px; accent-color: var(--primary-orange);">
                </div>
            </div>

            <div id="recurring-options" style="display: none; background: #fdfdfe; padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
                <div class="form-group">
                    <label for="recurring-frequency">Frequency</label>
                    <select id="recurring-frequency" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; background: var(--card-bg);">
                        <option value="WEEKLY">Weekly</option>
                        <option value="MONTHLY">Monthly</option>
                    </select>
                </div>
                <div class="form-group" id="recurring-days-wrapper">
                    <label>Days of Week</label>
                    <div id="recurring-days" style="display: flex; justify-content: space-around; gap: 5px;">
                        <button type="button" class="day-btn" data-day="0">S</button>
                        <button type="button" class="day-btn" data-day="1">M</button>
                        <button type="button" class="day-btn" data-day="2">T</button>
                        <button type="button" class="day-btn" data-day="3">W</button>
                        <button type="button" class="day-btn" data-day="4">T</button>
                        <button type="button" class="day-btn" data-day="5">F</button>
                        <button type="button" class="day-btn" data-day="6">S</button>
                    </div>
                    <style>
                        .day-btn { width: 36px; height: 36px; border-radius: 50%; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-dark); cursor: pointer; }
                        .day-btn.active { background: var(--primary-orange); color: white; border-color: var(--primary-orange); }
                    </style>
                </div>
                <div class="form-group">
                    <label for="recurring-end-date">End Date (Optional)</label>
                    <input type="date" id="recurring-end-date">
                </div>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">Save Entry</button>
            
            <button type="button" id="delete-event-btn" class="btn btn-secondary" style="width: 100%; margin-top: 10px; background-color: var(--primary-red-light); color: var(--primary-red); border: none; display: none;">
                Delete Entry
            </button>
        </form>
    </div>
</div>
<! ============== schedule Model End ================== !>

<! ============== Staff Model Start ================== !>
    <div id="staff-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="staff-modal-title">Add New Rider</h2>
                <span class="close-btn" data-modal="staff-modal">×</span>
            </div>
            
            <form id="staff-form" style="padding: 20px;">
                <input type="hidden" id="staff-id">
                
                <div class="form-group">
                    <label for="staff-name">Rider Name*</label>
                    <input type="text" id="staff-name" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Save Rider</button>
            </form>
        </div>
    </div>
    

    </div> 
<! ============== Staff Model End ================== !>
    
<! =========================================== !>
<! ============== Modal End ================== !>
<! ========================================= !>

	
<script type="module">
//*==========================================*//
//*============== Firebase Config Start ==============*//
//*==========================================*//
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"; // <-- YEH ADD KAREIN
import { getFirestore, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
// YEH FIX 2 HAI: Galat space ('&') aur faltu space hata diye gaye hain
import { collection, addDoc, getDocs, onSnapshot, doc, updateDoc, deleteDoc, setDoc, getDoc, getCountFromServer, query, where, orderBy, serverTimestamp, limit} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// --- Paste Your Firebase Project Configuration Here ---
const firebaseConfig = {
    apiKey: "AIzaSyCxVmGqlbomo47KqXZm4S8QqfL3bXZN6pg",
    authDomain: "drywash-7d086.firebaseapp.com",
    projectId: "drywash-7d086",
    storageBucket: "drywash-7d086.firebasestorage.app",
    messagingSenderId: "850083946512",
    appId: "1:850083946512:web:f0ae239d283abd1dffaa95",
    measurementId: "G-TLPBTQ31KT"
  };
// --- End Firebase Project Configuration ---

// --- Initialize Firebase App ---
// This creates the connection to your Firebase project
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
// --- End Initialize Firebase App ---

// --- Firebase Services (No export needed) ---
// YEH FIX 3 HAI: 'export' keyword hata diya hai
const db = getFirestore(app); // Firestore Database service
// 'export { Timestamp }' hata diya gaya hai, kyunki 'Timestamp' upar import ho chuka hai.
// --- End Firebase Services ---

//*==========================================*//
//*============== Firebase Config End ==============*//
//*==========================================*//
 
//*============== Auth Guard Start ==============*//
onAuthStateChanged(auth, (user) => {
    if (user) {
        // User logged in hai
        console.log("Auth Guard: User is logged in.", user.email);
    } else {
        // User logged in nahin hai, use auth.html par bhej dein
        console.log("Auth Guard: No user found. (Redirect disabled for testing)");
        // YEH FIX 4 HAI: Testing ke liye redirect ko comment kar diya hai
        // window.location.href = 'auth.html';
    }
});
//*============== Auth Guard End ==============*//
 
    //*============== App.js Start==================*//
    document.addEventListener('DOMContentLoaded', function() {
        
    // --- 0. नया पेज नेविगेशन लॉजिक ---
    const navLinks = document.querySelectorAll('[data-page]'); 
    const contentPages = document.querySelectorAll('.page-content');
    const sidebarNavListItems = document.querySelectorAll('.sidebar-nav li');
    const bottomNavItems = document.querySelectorAll('.bottom-nav .nav-item');
    const sidebar = document.getElementById('sidebar');

    navLinks.forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault(); // लिंक को पेज रीलोड करने से रोकें
            
            const targetPageId = this.getAttribute('data-page');
            const targetPage = document.getElementById(targetPageId);

            // 1. अगर पेज मौजूद है, तभी आगे बढ़ें
            if (targetPage) {
                // 1a. सभी पेजों को छिपाएँ
                contentPages.forEach(page => {
                    page.style.display = 'none';
                });

                // 1b. सिर्फ टारगेट पेज को दिखाएँ
                targetPage.style.display = 'block';

                // 1c. मेनू में 'active' क्लास को अपडेट करें
                // Pehle sabhi active classes hatao
                sidebarNavListItems.forEach(item => item.classList.remove('active'));
                bottomNavItems.forEach(item => item.classList.remove('active'));

                // Ab target ke hisaab se sahi menu item ko active karo
                // Sidebar
                const sidebarLink = document.querySelector(`.sidebar-nav a[data-page="${targetPageId}"]`);
                if (sidebarLink) {
                    sidebarLink.parentElement.classList.add('active');
                }
                
                // Bottom Nav
                const bottomNavLink = document.querySelector(`.bottom-nav .nav-item[data-page="${targetPageId}"]`);
                if (bottomNavLink) {
                    bottomNavLink.classList.add('active');
                }
                
                // 1d. मोबाइल पर मेनू बंद करें
                if (sidebar && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            } else {
                console.warn("Page not found:", targetPageId); // अगर पेज न मिले तो चेतावनी दें
            }
        });
    });

    // --- 1. मोबाइल मेनू टॉगल ---
    const menuToggleBtn = document.getElementById('menu-toggle-btn');
    // const sidebar = document.getElementById('sidebar'); // (पहले ही ऊपर डिफाइन कर दिया है)

    if (menuToggleBtn && sidebar) {
        menuToggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });
    }

    // --- 2. मोबाइल पर साइडबार के बाहर क्लिक करने पर बंद करें ---
    document.addEventListener('click', function(event) {
        if (sidebar && !sidebar.contains(event.target) && menuToggleBtn && !menuToggleBtn.contains(event.target) && sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
        }
    });

    // --- 3. मोबाइल-ओनली एक्शन को हैंडल करना (सिर्फ डैशबोर्ड पर) ---
    const mobileActions = document.querySelector('.mobile-only-quick-actions');
    const desktopActions = document.querySelector('.desktop-content'); // Selector badal diya hai

    function handleResponsiveLayout() {
        if (!mobileActions || !desktopActions) return; // अगर पेज पर नहीं है तो बाहर निकलें

        if (window.innerWidth < 768) {
            mobileActions.style.display = 'block';
            // desktopActions ko CSS se handle hone dein (display: none)
        } else {
            mobileActions.style.display = 'none';
            // desktopActions ko CSS se handle hone dein (display: block)
        }
    }

    // पेज लोड और रीसाइज़ पर चलाएँ
    handleResponsiveLayout();
    window.addEventListener('resize', handleResponsiveLayout);
  // --- 4. NAYA LOGOUT EVENT LISTENER ---
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                signOut(auth).then(() => {
                    console.log('User signed out.');
                    // Auth guard (onAuthStateChanged) apne aap redirect kar dega
                }).catch((error) => {
                    console.error('Sign out error', error);
                });
            }
        });
    }

    // YEH FIX 5 HAI: Saara data loading code yahaan move kar diya hai
    // Taaki yeh HTML load hone ke baad chale
    console.log("DOM Loaded. Initializing all data functions...");
    loadDashboardStats();
    loadRecentOrders();
    loadWeeklyChart();
    loadProductsAndCategories(); // POS page ke liye
    loadOrders(); // Orders page ke liye
    loadCustomers(); // Customers page ke liye
    initCashRegister(); // Cash Register page ke liye
    // Note: Staff aur Schedule page lazy-loaded hain (jab unpar click hoga tab load honge)

});
//*============== App.js End==================*//

//*==========================================*//
//*============== Dasboard Start ==================*//
//*==========================================*//
// --- Feature: Stats Cards Load Start ---
async function loadDashboardStats() {
    console.log("Loading dashboard stats from Firebase...");
    
    // Get today's date range for queries
    const now = new Date();
    const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()); // Today 00:00:00
    const todayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1); // Tomorrow 00:00:00
    
    // Convert to Firebase Timestamps (Make sure Timestamp is imported)
    const todayStartTimestamp = Timestamp.fromDate(todayStart);
    const todayEndTimestamp = Timestamp.fromDate(todayEnd);

    try {
        // Reference to the 'orders' collection
        const ordersRef = collection(db, "orders");

        // --- Today's Orders ---
        const todayOrdersQuery = query(ordersRef, 
            where("createdAt", ">=", todayStartTimestamp), 
            where("createdAt", "<", todayEndTimestamp)
        );
        const todayOrdersSnapshot = await getDocs(todayOrdersQuery);
        document.getElementById('stats-today-orders').textContent = todayOrdersSnapshot.size;

        // --- Total Pending Orders ---
        const pendingQuery = query(ordersRef, where('status', '==', 'PENDING'));
        const pendingSnapshot = await getDocs(pendingQuery);
        document.getElementById('stats-pending').textContent = pendingSnapshot.size;
        
        // --- Total Delivered Orders ---
        // Replace 'DELIVERED' if you use a different status name
        const deliveredQuery = query(ordersRef, where('status', '==', 'DELIVERED')); 
        const deliveredSnapshot = await getDocs(deliveredQuery);
        document.getElementById('stats-delivered').textContent = deliveredSnapshot.size;
        
        // --- Total Customers ---
        // Make sure getCountFromServer is imported
        const customersRef = collection(db, "customers");
        const customersCountSnapshot = await getCountFromServer(customersRef); 
        document.getElementById('stats-customers').textContent = customersCountSnapshot.data().count;

        // --- Unpaid Orders ---
        const unpaidQuery = query(ordersRef, where('paymentStatus', '==', 'UNPAID'));
        const unpaidSnapshot = await getDocs(unpaidQuery);
        document.getElementById('stats-unpaid').textContent = unpaidSnapshot.size;

        // --- Total Pickup Requests (Today - non-recurring only) ---
        const scheduleRef = collection(db, "schedule");
        const pickupQuery = query(scheduleRef, 
            where("extendedProps.type", "==", "PICKUP"),
            where("start", ">=", todayStartTimestamp),
            where("start", "<", todayEndTimestamp)
            // Note: This needs adjustment for recurring tasks.
        );
        const pickupSnapshot = await getDocs(pickupQuery);
        document.getElementById('stats-pickup').textContent = pickupSnapshot.size;

    } catch (error) {
        console.error("Error loading dashboard stats:", error);
        // Set UI elements to an error state or default
        document.getElementById('stats-today-orders').textContent = 'ERR';
        document.getElementById('stats-pending').textContent = 'ERR';
        document.getElementById('stats-delivered').textContent = 'ERR';
        document.getElementById('stats-customers').textContent = 'ERR';
        document.getElementById('stats-unpaid').textContent = 'ERR';
        document.getElementById('stats-pickup').textContent = 'ERR';
    }
}
// --- Feature: Stats Cards Load End ---


// --- Feature: Recent Orders Table Load Start ---
async function loadRecentOrders() {
    const tableBody = document.getElementById('orders-table-body');
    if (!tableBody) return; // Exit if table body doesn't exist
    
    tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Loading recent orders...</td></tr>';
    
    try {
        const ordersRef = collection(db, "orders");
        // Query for the 5 most recent orders based on creation time
        const recentOrdersQuery = query(ordersRef, orderBy('createdAt', 'desc'), limit(5));
        const snapshot = await getDocs(recentOrdersQuery);
        
        if (snapshot.empty) {
            tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No recent orders found.</td></tr>';
            return;
        }
        
        tableBody.innerHTML = ''; // Clear the loading message
        snapshot.forEach(doc => {
            const order = doc.data();
            // Format the Firestore Timestamp to a readable date string
            const orderDate = order.createdAt ? order.createdAt.toDate().toLocaleDateString() : 'N/A';
            // Calculate total quantity from the items array
            const quantity = order.items ? order.items.reduce((sum, item) => sum + (item.qty || 0), 0) : 'N/A'; 

            // Create the table row HTML
            const row = `
                <tr>
                    <td>${doc.id.substring(0, 6).toUpperCase()}</td> 
                    <td>${order.customerName || 'N/A'}</td>
                    <td>${orderDate}</td>
                    <td>${quantity}</td>
                    <td><span class="status-badge ${order.status ? order.status.toLowerCase() : 'pending'}">${order.status || 'PENDING'}</span></td>
                </tr>
            `;
            tableBody.innerHTML += row; // Add the row to the table
        });
    } catch (error) {
        console.error("Error loading recent orders:", error);
        tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: red;">Error loading orders.</td></tr>';
    }
}
// --- Feature: Recent Orders Table Load End ---


// --- Feature: Weekly Chart Load Start ---
async function loadWeeklyChart() {
    const ctx = document.getElementById('weeklyChart');
    if (!ctx) return; // Exit if chart canvas doesn't exist

    const labels = []; // Chart labels (e.g., 'Mon', 'Tue')
    const dataCounts = []; // Order counts for each day
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Set to the beginning of today

    try {
        // Loop through the last 7 days (including today)
        for (let i = 6; i >= 0; i--) {
            // Calculate start and end Timestamps for each day
            const dayStart = new Date(today);
            dayStart.setDate(today.getDate() - i);
            const dayEnd = new Date(dayStart);
            dayEnd.setDate(dayStart.getDate() + 1);

            const dayStartTimestamp = Timestamp.fromDate(dayStart);
            const dayEndTimestamp = Timestamp.fromDate(dayEnd);

            // Query orders created within that day's range
            const dayQuery = query(collection(db, "orders"),
                where("createdAt", ">=", dayStartTimestamp),
                where("createdAt", "<", dayEndTimestamp)
            );
            const daySnapshot = await getDocs(dayQuery);
            
            // Add the day's label and order count to the arrays
            labels.push(dayStart.toLocaleDateString('en-US', { weekday: 'short' })); 
            dataCounts.push(daySnapshot.size);
        }

        // Check if a chart instance already exists on the canvas and destroy it
        const existingChart = Chart.getChart(ctx);
        if (existingChart) {
            existingChart.destroy();
        }

        // Create the new Chart.js bar chart
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Orders',
                    data: dataCounts, 
                    backgroundColor: 'var(--primary-orange)', // Use your theme color
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // Important for fitting in container
                plugins: { legend: { display: false } }, // Hide the legend
                scales: {
                    y: { beginAtZero: true }, // Start y-axis at 0
                    x: { grid: { display: false } } // Hide vertical grid lines
                }
            }
        });

    } catch (error) {
        console.error("Error loading weekly chart data:", error);
        // Optionally display an error message on the chart canvas
        const context = ctx.getContext('2d');
        context.clearRect(0, 0, ctx.width, ctx.height); // Clear canvas
        context.fillStyle = 'red';
        context.textAlign = 'center';
        context.fillText('Error loading chart data', ctx.width / 2, ctx.height / 2);
    }
}
// --- Feature: Weekly Chart Load End ---


// --- Initialization ---
// YEH FIX 6 HAI: Saari initialization calls upar DOMContentLoaded mein move kar di gayi hain
// Isliye yeh section ab khaali hai
//*==========================================*//
//*============== Dasboard End==================*//
//*==========================================*//

//*==========================================*//
//*============== Pos Start ==================*//
//*===========================================*//
// --- 1. DOM ELEMENTS ---
// --- DOM Elements Start ---
const productGrid = document.getElementById('product-grid');
const productFilters = document.getElementById('product-filters');
const cartItemsList = document.getElementById('cart-items-list');
const subtotalEl = document.getElementById('summary-subtotal');
const totalEl = document.getElementById('summary-total');
const placeOrderBtn = document.getElementById('place-order-btn');

// Forms
const customItemForm = document.getElementById('custom-item-form');
const customerPhoneInput = document.getElementById('customer-phone');
const customerNameInput = document.getElementById('customer-name');

// Feature: Express Order Checkbox
const isExpressCheckbox = document.getElementById('is-express-order');
// --- DOM Elements End ---


// --- 2. STATE ---
// --- State Start ---
let cart = []; // Format: { id, name, price, qty }
let allProducts = []; // Stores products fetched from Firebase or demo
// --- State End ---


// --- 3. INITIALIZATION & DATA LOADING ---
// --- Data Loading Start ---
async function loadProductsAndCategories() { // Made async for Firebase
    console.log("Loading products...");
    
    // Clear previous data
    allProducts = [];
    if (productFilters) {
        // Clear old filters except 'All'
        const existingFilters = productFilters.querySelectorAll('.filter-btn:not([data-category="all"])');
        existingFilters.forEach(btn => btn.remove());
    }

    try {
        // --- Firebase Product Loading Start ---
        const productsCol = collection(db, 'products'); // Assumes a 'products' collection
        const snapshot = await getDocs(productsCol);
        
        const categories = new Set();
        snapshot.forEach(doc => {
            const product = { id: doc.id, ...doc.data() };
            allProducts.push(product);
            if (product.category) categories.add(product.category);
        });
        // --- Firebase Product Loading End ---
        
        renderCategories(categories);
        renderProducts('all'); // Initially render all products

    } catch (error) {
        console.error("Error loading products from Firebase: ", error);
        productGrid.innerHTML = '<p style="color: red;">Error loading products. Please try again.</p>';
        // Fallback to demo data if needed, or show error
        /*
        // --- Demo Data Start (Fallback) ---
        allProducts = [
            { id: 'p1', name: 'Shirt', price: 25, icon: 'fa-shirt', category: 'Wash & Iron' },
            // ... other demo products
        ];
        const categories = new Set(allProducts.map(p => p.category));
        renderCategories(categories);
        renderProducts('all');
        // --- Demo Data End ---
        */
    }
}
// --- Data Loading End ---


// --- 4. CATEGORY & PRODUCT RENDERING ---
// --- Rendering Start ---
function renderCategories(categories) {
    if (!productFilters) return;
    categories.forEach(category => {
        // Avoid adding duplicate category buttons if function is called again
        if (productFilters.querySelector(`[data-category="${category}"]`)) return;
        
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.textContent = category;
        btn.dataset.category = category;
        productFilters.appendChild(btn);
    });
}

function renderProducts(category) {
    if (!productGrid) return;
    
    productGrid.innerHTML = ''; // Clear grid
    const filteredProducts = (category === 'all')
        ? allProducts
        : allProducts.filter(p => p.category === category);
    
    if (filteredProducts.length === 0) {
        productGrid.innerHTML = '<p>No products found in this category.</p>';
        return;
    }

    filteredProducts.forEach(p => {
        const card = document.createElement('div');
        card.className = 'action-card product-card';
        card.innerHTML = `
            <i class="fa-solid ${p.icon || 'fa-tag'}"></i>
            <div class="name">${p.name}</div>
            <div class="price">$${p.price ? p.price.toFixed(2) : '0.00'}</div> 
        `;
        card.addEventListener('click', () => addToCart(p.id, p.name, p.price || 0, 1));
        productGrid.appendChild(card);
    });
}
// --- Rendering End ---


// --- 5. CART LOGIC ---
// --- Cart Logic Start ---
function addToCart(id, name, price, qty) {
    const existingItem = cart.find(item => item.id === id);
    if (existingItem) {
        existingItem.qty += qty;
    } else {
        cart.push({ id, name, price: parseFloat(price), qty: parseFloat(qty) });
    }
    renderCart();
}

function updateQuantity(id, change) {
    const item = cart.find(item => item.id === id);
    if (!item) return;

    item.qty += change;
    if (item.qty <= 0) {
        cart = cart.filter(cartItem => cartItem.id !== id);
    }
    renderCart();
}
    
function renderCart() {
    if (!cartItemsList) return;

    cartItemsList.innerHTML = '';
    if (cart.length === 0) {
        cartItemsList.innerHTML = '<div class="cart-empty-msg">Cart is empty</div>';
    } else {
        cart.forEach(item => {
            const itemEl = document.createElement('div');
            itemEl.className = 'cart-item';
            const itemTotal = (item.price * item.qty).toFixed(2);
            const isCustom = item.id.startsWith('custom-');
            
            itemEl.innerHTML = `
                <div class="cart-item-details">
                    <div class="name">${item.name}</div>
                    <div class="price">$${item.price.toFixed(2)} x ${item.qty} = <strong>$${itemTotal}</strong></div>
                </div>
                <div class="cart-item-qty">
                    ${!isCustom ? 
                    `<button class="qty-change" data-id="${item.id}" data-change="-1">-</button>
                     <span class="qty-value">${item.qty}</span>
                     <button class="qty-change" data-id="${item.id}" data-change="1">+</button>` : 
                     `<span class="qty-value">${item.qty} ${item.name.toLowerCase().includes('kg') ? 'kg' : 'unit'}</span>`}
                </div>
                <button class="cart-item-remove" data-id="${item.id}">
                    <i class="fa-solid fa-trash-can"></i>
                </button>
            `;
            cartItemsList.appendChild(itemEl);
        });
    }
    updateTotals(); 
}
    
function updateTotals() {
    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
    const discount = 0; // Placeholder for future discount logic
    const total = subtotal - discount;
    
    if (subtotalEl) subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
    if (totalEl) totalEl.textContent = `$${total.toFixed(2)}`;
}
// --- Cart Logic End ---


// --- 6. EVENT HANDLERS ---
// --- Event Handlers Start ---

// Handler: Category filter buttons
if (productFilters) {
    productFilters.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON' && e.target.classList.contains('filter-btn')) {
            // Remove active class from previously active button
             const currentActive = productFilters.querySelector('.filter-btn.active');
             if (currentActive) currentActive.classList.remove('active');
            // Add active class to the clicked button
            e.target.classList.add('active');
            // Render products for the selected category
            renderProducts(e.target.dataset.category);
        }
    });
}


// Handler: Cart item buttons (Quantity/Remove)
if (cartItemsList) {
    cartItemsList.addEventListener('click', (e) => {
        const target = e.target.closest('button');
        if (!target) return;
        
        const id = target.dataset.id;
        if (target.classList.contains('qty-change')) {
            updateQuantity(id, parseInt(target.dataset.change));
        }
        if (target.classList.contains('cart-item-remove')) {
            cart = cart.filter(item => item.id !== id);
            renderCart();
        }
    });
}

// --- Feature: Custom Item Form Start ---
if (customItemForm) {
    customItemForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const nameInput = document.getElementById('custom-item-name');
        const qtyInput = document.getElementById('custom-item-qty');
        const priceInput = document.getElementById('custom-item-price');

        const name = nameInput.value;
        const qty = parseFloat(qtyInput.value);
        const price = parseFloat(priceInput.value);

        if (!name || isNaN(qty) || isNaN(price) || qty <= 0 || price < 0) { // Price can be 0
            alert("Please fill all custom item fields with valid inputs (Name, Qty > 0, Price >= 0).");
            return;
        }

        const customId = `custom-${Date.now()}`;
        addToCart(customId, name, price, qty);

        // Reset only the custom form fields
        nameInput.value = '';
        qtyInput.value = 1;
        priceInput.value = '';
    });
}
// --- Feature: Custom Item Form End ---

// Handler: Place Order button click
if (placeOrderBtn) {
    placeOrderBtn.addEventListener('click', async () => { // Make async for Firebase
        const customerPhone = customerPhoneInput ? customerPhoneInput.value : '';
        if (cart.length === 0) {
            alert("Cart is empty!"); return;
        }
        if (!customerPhone) {
            alert("Customer Phone is required."); 
            if (customerPhoneInput) customerPhoneInput.focus();
            return;
        }

        // --- Feature: Express Order Data Start ---
        const orderData = {
            customerPhone: customerPhone,
            customerName: customerNameInput ? customerNameInput.value : '',
            items: cart,
            subtotal: parseFloat(subtotalEl.textContent.replace('$', '')),
            total: parseFloat(totalEl.textContent.replace('$', '')),
            status: 'PENDING',
            paymentStatus: 'UNPAID',
            isExpress: isExpressCheckbox ? isExpressCheckbox.checked : false, // Check if checkbox exists
            createdAt: serverTimestamp() // Use Firebase server time
        };
        // --- Feature: Express Order Data End ---

        console.log("Saving order to Firebase...", orderData);
        placeOrderBtn.disabled = true; // Prevent double clicks
        placeOrderBtn.textContent = 'Placing Order...';

        // --- Firebase Save Logic Start ---
        try {
            const docRef = await addDoc(collection(db, "orders"), orderData);
            alert(`Order Placed Successfully! Invoice ID: ${docRef.id}`);
            
            // Clear cart and form after successful save
            cart = [];
            renderCart();
            if (customerPhoneInput) customerPhoneInput.value = '';
            if (customerNameInput) customerNameInput.value = '';
            if (isExpressCheckbox) isExpressCheckbox.checked = false;
            
        } catch (error) {
            console.error("Error adding document: ", error);
            alert("Error placing order. Please check the console and try again.");
        } finally {
             placeOrderBtn.disabled = false; // Re-enable button
             placeOrderBtn.textContent = 'Charge & Place Order';
        }
        // --- Firebase Save Logic End ---
    });
}
// --- Event Handlers End ---

//*==========================================*//
//*============== Pos End ====================*//
//*===========================================*//

//*==========================================*//
//*============== Order Start ==================*//
//*==========================================*//
    // --- 1. DOM ELEMENTS ---
    // Is section mein hum page ke sabhi zaroori HTML elements ko select kar rahe hain.
    // --- DOM Elements Start ---
    
    // YEH BADLAAV KIYA GAYA HAI
    const ordersTableBody = document.getElementById('orders-list-body');
    const orderSearchInput = document.getElementById('order-search');
    
    // Order Details Modal elements
    const orderModal = document.getElementById('order-details-modal');
    // Check karein ki modal maujood hai ya nahin (error se bachne ke liye)
    const orderModalCloseBtn = orderModal ? orderModal.querySelector('.close-btn[data-modal="order-details-modal"]') : null;
    const printBtn = document.getElementById('print-order-tag-btn');
    // --- DOM Elements End ---       
    
    // --- 4. CORE FUNCTION: RENDER ORDER DETAILS MODAL ---
    async function renderOrderDetails(orderId) { // 'async' banayein
        if (!orderModal) return;

        try {
            // --- YEH BADLAAV HAI ---
            // 1. Data seedha Firebase se fetch karein
            const orderRef = doc(db, "orders", orderId);
            const docSnap = await getDoc(orderRef); // getDoc import karna hoga

            if (!docSnap.exists()) {
                alert("Error: Order not found.");
                return;
            }
            const order = { id: docSnap.id, ...docSnap.data() };
            // --- BADLAAV KHATAM ---

            // 2. Simple info bharein (Date format badlein)
            const orderDate = order.createdAt ? order.createdAt.toDate().toLocaleString() : 'N/A';
            document.getElementById('modal-order-date').textContent = orderDate;
            
            // ... (Baaki poora function waisa hi rahega) ...
            
            // 6. Print feature ke liye current ID save karein
            // currentViewingOrderId = orderId; // Yeh theek hai (Global variable hona chahiye)
            
            // 7. Modal kholein
            orderModal.style.display = 'block';

        } catch (error) {
            console.error("Error fetching order details:", error);
            alert("Could not load order details.");
        }
    }
    // --- Render Details Modal Function End ---

    // --- 5. LOGIC: UPDATE STATUS ---
    async function updateStatus(orderId, newStatus) { // 'async' banayein
        console.log(`Updating ${orderId} to ${newStatus}`);
        
        // --- YEH BADLAAV HAI ---
        const orderRef = doc(db, "orders", orderId);
        try {
            await updateDoc(orderRef, {
                status: newStatus
            });
            // Data apne aap update ho jaayega (onSnapshot ke kaaran)
            if (orderModal) orderModal.style.display = 'none'; // Modal band karein
        } catch (error) {
            console.error("Error updating status: ", error);
            alert("Failed to update status.");
        }
        
    }
    // --- Update Status Function End ---

    
    // --- 6. FEATURE: PRINT GARMENT TAG ---
    // Yeh function modal se print button dabaane par naya window kholta hai.
    // --- Print Tag Function Start ---
    function printOrderTag(orderId) {
        // const order = allOrdersDemoData.find(o => o.id === orderId); // YEH DEMO DATA HAI
        // !! NOTE: Aapko 'allOrdersDemoData' ko Firebase se fetch kiye gaye data se badalna hoga
        // Abhi ke liye yeh function shayad kaam na kare jab tak data load na ho.
        alert("Print function needs to be connected to live data.");
        /*
        if (!order) return;

        let itemsHtml = '';
        order.items.forEach(item => {
            // Har item ke liye ek tag
            itemsHtml += `
                <div class="tag">
                    <h2>${order.id}</h2>
                    <h3>${item.name} (${item.qty} pcs)</h3>
                    <p>Customer: ${order.name}</p>
                    ${order.isExpress ? '<p><strong>** EXPRESS **</strong></p>' : ''}
                </div>
            `;
        });

        // Nayi print window kholein
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`... (Print HTML here) ...`);
        printWindow.document.close();
        */
    }
    // --- Print Tag Function End ---

    
    // --- 7. EVENT LISTENERS SETUP ---
    // Yeh function page load hone par sabhi zaroori event listeners ko setup karta hai.
    // --- Event Listeners Start ---
    function setupOrderEventListeners() {
        // YEH BADLAAV KIYA GAYA HAI
        // Check karein ki zaroori elements page par hain
        if (!ordersTableBody || !orderSearchInput || !orderModal || !orderModalCloseBtn || !printBtn) {
            console.warn("Order management elements not found. Skipping listeners.");
            return;
        }

        // 1. Search (Jaise hi user type karega, list filter hogi)
        // YEH BADLAAV KIYA GAYA HAI
        orderSearchInput.addEventListener('input', (e) => {
            loadOrders(e.target.value.toLowerCase()); // 'loadOrders' function define hona chahiye
        });

        // 2. "View" button click (Event Delegation)
        // Hum poori table body par ek listener laga rahe hain.
        // YEH BADLAAV KIYA GAYA HAI
        ordersTableBody.addEventListener('click', (e) => {
            const viewButton = e.target.closest('.btn-view-order');
            if (viewButton) {
                const orderId = viewButton.getAttribute('data-id');
                renderOrderDetails(orderId);
            }
        });
        
        // 3. Modal ka Close (X) button
        // YEH BADLAAV KIYA GAYA HAI
        if (orderModalCloseBtn) { // Check karein ki button hai
            orderModalCloseBtn.addEventListener('click', () => {
                orderModal.style.display = 'none';
            });
        } // Yahaan 'k' HATA DIYA GAYA HAI

        // 4. Modal ke bahar click karne par modal band karein
        window.addEventListener('click', (e) => {
            if (e.target == orderModal) {
                orderModal.style.display = 'none';
            }
        });
        
        // 5. Print Button Click
        printBtn.addEventListener('click', () => {
            let currentViewingOrderId; // Isko globally define karein ya renderOrderDetails se set karein
            if (currentViewingOrderId) {
                printOrderTag(currentViewingOrderId);
            } else {
                alert('Error: Could not find order to print.');
            }
        });
    }
    // --- Event Listeners End ---
// --- 2. CORE FUNCTION: LOAD & RENDER ORDERS ---
// YEH FUNCTION AAPKE CODE MEIN MISSING THA
function loadOrders(searchTerm = "") {
    if (!ordersTableBody) return;
    ordersTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Loading orders...</td></tr>';

    // 'orders' collection ko sunein
    const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));

    // onSnapshot real-time listener hai
    onSnapshot(q, (snapshot) => {
        if (snapshot.empty) {
            ordersTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No orders found.</td></tr>';
            return;
        }

        ordersTableBody.innerHTML = ''; // Table khaali karein
        snapshot.forEach(doc => {
            const order = { id: doc.id, ...doc.data() };

            // Search filter
            const orderDate = order.createdAt ? order.createdAt.toDate().toLocaleDateString() : 'N/A';
            const searchText = (order.id + order.customerName + order.customerPhone + orderDate).toLowerCase();

            if (searchTerm && !searchText.includes(searchTerm)) {
                return; // Match nahin hua toh skip
            }

            // Render row
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${order.id.substring(0, 6).toUpperCase()}</td>
                <td>
                    <div>${order.customerName || 'N/A'}</div>
                    <small>${order.customerPhone || 'N/A'}</small>
                </td>
                <td>${orderDate}</td>
                <td>$${order.total ? order.total.toFixed(2) : '0.00'}</td>
                <td><span class="status-badge ${order.status ? order.status.toLowerCase() : 'pending'}">${order.status || 'PENDING'}</span></td>
                <td>
                    <button class="btn btn-secondary btn-view-order" data-id="${order.id}" style="padding: 5px 10px;">
                        <i class="fa-solid fa-eye"></i> View
                    </button>
                </td>
            `;
            ordersTableBody.appendChild(row);
        });
    });
}

// Is function ko 'Order' page par jaate hi call karein
const orderLink = document.querySelector('a[data-page="page-orders"]');
if (orderLink) {
    orderLink.addEventListener('click', () => {
        // loadOrders(); // Page load par call karein // DOMContentLoaded mein call ho raha hai
        setupOrderEventListeners(); // Listeners setup karein
    }, { once: true }); // Sirf ek baar
}
// Safety check agar user seedha Orders page par land hota hai
if (document.getElementById('page-orders').style.display !== 'none') {
    // loadOrders(); // DOMContentLoaded mein call ho raha hai
    setupOrderEventListeners();
}
//*==========================================*//
//*============== Order End ==================*//
//*===========================================*//

//*==========================================*//
//*============== schedule Start ==============*//
//*===========================================*//
    // --- 1. DOM ELEMENTS ---
    // Page ke sabhi zaroori HTML elements ko yahaan select kiya jaa raha hai
    // --- DOM Elements Start ---
    const calendarEl = document.getElementById('schedule-calendar');
    const scheduleModal = document.getElementById('schedule-modal');
    const form = document.getElementById('schedule-form');
    const modalTitle = document.getElementById('schedule-modal-title');
    const openModalBtn = document.getElementById('add-schedule-event-btn');
    // YEH BADLAAV KIYA GAYA HAI
    const closeModalBtn = scheduleModal ? scheduleModal.querySelector('.close-btn[data-modal="schedule-modal"]') : null;
    const deleteBtn = document.getElementById('delete-event-btn');
    
    // Form fields
    const eventIdInput = document.getElementById('event-id');
    const eventOrderSelect = document.getElementById('event-order-select');
    const eventTitleInput = document.getElementById('event-title'); // Hidden
    const eventTypeInput = document.getElementById('event-type');
    const eventRiderSelect = document.getElementById('event-rider-select');
    const eventDateInput = document.getElementById('event-date');
    const eventTimeInput = document.getElementById('event-time');

    // Feature: Recurring
    const isRecurringCheckbox = document.getElementById('is-recurring');
    const recurringOptionsDiv = document.getElementById('recurring-options');
    const recurringDaysContainer = document.getElementById('recurring-days');
    const recurringDaysButtons = recurringDaysContainer ? recurringDaysContainer.querySelectorAll('.day-btn') : [];
    const recurringEndDateInput = document.getElementById('recurring-end-date');

    // Feature: Route Optimize
    const routeRiderSelect = document.getElementById('route-rider-select');
    const optimizeRouteBtn = document.getElementById('optimize-route-btn');
    // IMPORTANT: Yahaan apna address daalein
    const YOUR_SHOP_ADDRESS = "123 Laundry Shop St, New Delhi"; 
    // --- DOM Elements End ---

    
    // --- 2. STATE & CALENDAR OBJECT ---
    // --- State Start ---
    let calendar; // Calendar object ko yahaan store karenge
    let selectedRecurringDays = []; // ['0', '3'] (Sunday, Wednesday)
    // --- State End ---

    
    // --- 3. MODAL & DATA FUNCTIONS ---
    // Modal ko kholne/band karne ke helper functions
    // --- Modal Functions Start ---
    function openModalForCreate(dateStr) {
        // YEH BADLAAV KIYA GAYA HAI
        if (!scheduleModal) return; 
        form.reset();
        modalTitle.textContent = 'Add New Entry';
        deleteBtn.style.display = 'none';
        eventIdInput.value = '';
        
        loadOrdersIntoDropdown(); 
        loadRidersIntoDropdown(eventRiderSelect); // Modal ka rider dropdown
        
        eventOrderSelect.style.display = 'block';
        eventDateInput.value = dateStr;
        
        // Recurring fields reset karein
        isRecurringCheckbox.checked = false;
        if(recurringOptionsDiv) recurringOptionsDiv.style.display = 'none';
        recurringDaysButtons.forEach(btn => btn.classList.remove('active'));
        selectedRecurringDays = [];
        
        // YEH BADLAAV KIYA GAYA HAI
        scheduleModal.style.display = 'block'; 
    }
    
    async function openModalForEdit(event) { // 'async' banaya
        // YEH BADLAAV KIYA GAYA HAI
        if (!scheduleModal) return; 
        form.reset();
        modalTitle.textContent = 'Edit Entry';
        deleteBtn.style.display = 'block';
        
        // Dono dropdown load karein
        await loadOrdersIntoDropdown();
        await loadRidersIntoDropdown(eventRiderSelect); 
        
        // Form data bharein
        eventIdInput.value = event.id;
        eventTitleInput.value = event.title; // Hidden title
        eventTypeInput.value = event.extendedProps.type;
        eventRiderSelect.value = event.extendedProps.riderId || "";
        
        // Date/Time
        const eventDate = new Date(event.start);
        eventDateInput.value = eventDate.toISOString().split('T')[0];
        if (!event.allDay) {
            eventTimeInput.value = eventDate.toTimeString().split(' ')[0].substring(0, 5);
        }

        // Agar order se linked hai toh dropdown chhipa do
        if (event.extendedProps.orderId) {
            eventOrderSelect.style.display = 'none';
        } else {
            eventOrderSelect.style.display = 'block';
        }

        // Recurring fields
        if (event.extendedProps.isRecurring) {
            isRecurringCheckbox.checked = true;
            recurringOptionsDiv.style.display = 'block';
            const rule = event.extendedProps.recurringRule;
            selectedRecurringDays = rule.days;
            recurringDaysButtons.forEach(btn => {
                if (rule.days.includes(btn.dataset.day)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            recurringEndDateInput.value = rule.end || '';
        } else {
            isRecurringCheckbox.checked = false;
            recurringOptionsDiv.style.display = 'none';
        }
        
        // YEH BADLAAV KIYA GAYA HAI
        scheduleModal.style.display = 'block'; 
    }
    
    function closescheduleModal() {
        // YEH BADLAAV KIYA GAYA HAI
        if (scheduleModal) scheduleModal.style.display = 'none';
    }
    
    function getEventColor(type) {
        return (type === 'PICKUP') ? '#3699FF' : '#50CD89';
    }
    // --- Modal Functions End ---

    
//*============== drop-down Start ==============*//
    // --- Feature: Data Loading Functions (Firebase) ---
    async function loadOrdersIntoDropdown() {
        if (!eventOrderSelect) return;
        
        // 'window.allOrdersDemoData' ki jagah seedha Firebase se query karein
        
        eventOrderSelect.innerHTML = '<option value="">-- Select an Order --</option><option value="CUSTOM">-- Custom (No Order) --</option>';

        // Sirf PENDING ya READY orders hi laayein
        const q = query(collection(db, "orders"), 
                        where("status", "in", ["PENDING", "READY"]));
        
        try {
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
                const order = { id: doc.id, ...doc.data() };
                const option = document.createElement('option');
                // Value mein poora data store karein (JSON format)
                option.value = JSON.stringify(order); 
                option.textContent = `${order.id.substring(0,6)} - ${order.customerName} (${order.status})`;
                eventOrderSelect.appendChild(option);
            });
        } catch (error) {
            console.error("Error loading orders into dropdown: ", error);
        }
    }
    
    async function loadRidersIntoDropdown(selectElement) {
        if (!selectElement) return;
        
        // Pehle se bhara hua data check karein (taaki baar-baar load na ho)
        if(selectElement.options.length > 2) return; 

        console.log("Loading riders from Firebase...");
        selectElement.innerHTML = '<option value="">-- Unassigned --</option>';
        
        try {
            const querySnapshot = await getDocs(collection(db, "riders"));
            querySnapshot.forEach((doc) => {
                const rider = { id: doc.id, ...doc.data() };
                const option = document.createElement('option');
                option.value = rider.id;
                option.textContent = rider.name;
                selectElement.appendChild(option);
            });
        } catch (error) {
            console.error("Error loading riders into dropdown: ", error);
        }
    }
//*============== drop-down end ==============*//

    
//*============== Calander Start ==============*//
    // --- 4. CALENDAR INITIALIZATION ---
    function initCalendar() {
        if (!calendarEl) {
            console.warn("Calendar element not found. Skipping init.");
            return;
        }
        if (calendar) { // Agar pehle se bana hai toh dobara na banayein
            return;
        }

        console.log("Initializing Calendar...");
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,dayGridWeek,dayGridDay'
            },
            editable: true,
            
            // --- Firebase Data Loading ---
            // 'events' array ki jagah 'events' function ka istemaal karein
            events: function(fetchInfo, successCallback, failureCallback) {
                
                const q = query(collection(db, "schedule"));
                
                // onSnapshot real-time listener hai
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    let events = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        
                        // Recurring event
                        if (data.daysOfWeek) {
                            events.push({
                                id: doc.id,
                                title: data.title,
                                daysOfWeek: data.daysOfWeek,
                                startTime: data.startTime,
                                endTime: data.endTime,
                                startRecur: data.startRecur,
                                endRecur: data.endRecur,
                                backgroundColor: data.backgroundColor,
                                borderColor: data.borderColor,
                                extendedProps: data.extendedProps
                            });
                        } 
                        // Normal event
                        else {
                            events.push({
                                id: doc.id,
                                title: data.title,
                                // Timestamp ko JS Date mein badlein
                                start: data.start.toDate(), 
                                allDay: data.allDay,
                                backgroundColor: data.backgroundColor,
                                borderColor: data.borderColor,
                                extendedProps: data.extendedProps
                            });
                        }
                    });
                    successCallback(events); // Calendar ko events dein
                }, (error) => {
                    console.error("Error fetching schedule: ", error);
                    failureCallback(error);
                });
                
                // Note: onSnapshot listener ko clean up karna production app mein zaroori hai
            },

            // Calendar par click karke naya event banana
            dateClick: (info) => openModalForCreate(info.dateStr),
            
            // Puraane event par click karke edit karna
            eventClick: (info) => openModalForEdit(info.event),
            
            // Event ko drag-drop karke update karna
            eventDrop: async (info) => { 
                try {
                    const eventRef = doc(db, "schedule", info.event.id);
                    await updateDoc(eventRef, {
                        start: info.event.start // Naya start time save karein
                    });
                    console.log("Event drop updated in Firebase!");
                } catch (error) {
                    console.error("Error updating event drop:", error);
                }
            }
        });
        
        calendar.render();
    }
//*============== Calander end ==============*//

    
    // --- 5. EVENT LISTENERS SETUP ---
    // (Modal buttons, Form submission, Route Optimization)
    // --- Event Listeners Start ---
    
    // Check karein ki zaroori elements maujood hain
    // YEH BADLAAV KIYA GAYA HAI
    if (!scheduleModal || !form || !openModalBtn || !closeModalBtn || !deleteBtn || !isRecurringCheckbox) {
         console.warn("schedule modal elements not found. Skipping listeners.");
         // return; // Abhi ke liye return ko comment kar rahe hain
    }

    // Modal buttons
    if(openModalBtn) openModalBtn.addEventListener('click', () => openModalForCreate(new Date().toISOString().split('T')[0]));
    
    // YEH BADLAAV KIYA GAYA HAI (BUG FIX)
    if (closeModalBtn) { // Check karein ki button hai
        closeModalBtn.addEventListener('click', closescheduleModal);
    }

    window.addEventListener('click', (e) => {
        // YEH BADLAAV KIYA GAYA HAI
        if (e.target == scheduleModal) closescheduleModal(); // closeModal -> closescheduleModal
    });

    // --- Feature: Recurring Checkbox Toggle ---
    if(isRecurringCheckbox) isRecurringCheckbox.addEventListener('change', () => {
        recurringOptionsDiv.style.display = isRecurringCheckbox.checked ? 'block' : 'none';
    });
    recurringDaysButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            btn.classList.toggle('active');
            const day = btn.dataset.day;
            if (btn.classList.contains('active')) {
                selectedRecurringDays.push(day);
            } else {
                selectedRecurringDays = selectedRecurringDays.filter(d => d !== day);
            }
        });
    });

    // --- Form Submit (Save/Update) ---
    if(form) form.addEventListener('submit', async (e) => { // 'async' banaya
        e.preventDefault();
        
        const id = eventIdInput.value;
        const type = eventTypeInput.value;
        const date = eventDateInput.value;
        const time = eventTimeInput.value;
        
        // Rider
        const selectedRiderId = eventRiderSelect.value;
        const selectedRiderName = selectedRiderId ? eventRiderSelect.options[eventRiderSelect.selectedIndex].text : null;
        const riderPrefix = selectedRiderName ? `[${selectedRiderName}] ` : "[Unassigned] ";
        
        // Event data (default)
        let title = '';
        let extendedProps = {
            type: type,
            riderId: selectedRiderId,
            riderName: selectedRiderName
        };
        
        // Order
        const selectedOrderValue = eventOrderSelect.value;
        if (!selectedOrderValue) {
            alert('Please select an order or a custom task.');
            return;
        }

        if (selectedOrderValue === "CUSTOM") {
            title = prompt("Please enter a custom title for this event:", "Custom Task");
            if (!title) return; // Agar user ne cancel kiya
            extendedProps.customerName = "Custom";
        } else {
            // Parse order data jo JSON mein store kiya tha
            const order = JSON.parse(selectedOrderValue);
            const typeText = (type === 'PICKUP') ? 'Pickup' : 'Delivery';
            title = `${typeText} - ${order.customerName} (${order.id.substring(0,6)})`;
            
            // Rider App ke liye zaroori data save karein
            extendedProps.orderId = order.id;
            extendedProps.customerName = order.customerName;
            extendedProps.customerPhone = order.customerPhone; // Zaroori
            extendedProps.customerAddress = order.address; // Zaroori
        }

        if (id) { 
            // Edit Mode - Title ko update karein
            let oldTitle = eventTitleInput.value.replace(/^\[.*?\]\s*/, ""); // Puraana prefix hatao
            title = riderPrefix + oldTitle;
        } else {
            // Create Mode
            title = riderPrefix + title;
        }
        
        eventTitleInput.value = title; // Hidden input update karein

        // Naya event object banayein jo Firebase mein save hoga
        let newEventData = {
            id: id || doc(collection(db, "schedule")).id, // Nayi ID generate karein
            title: title,
            backgroundColor: getEventColor(type),
            borderColor: getEventColor(type),
            extendedProps: extendedProps
        };
        
        // --- Feature: Recurring Logic Save ---
        if (isRecurringCheckbox.checked) {
            if (selectedRecurringDays.length === 0) {
                alert('Please select at least one day for recurring event.');
                return;
            }
            newEventData.daysOfWeek = selectedRecurringDays;
            newEventData.startTime = time || '09:00:00'; // Default time
            newEventData.startRecur = date;
            if (recurringEndDateInput.value) {
                newEventData.endRecur = recurringEndDateInput.value;
            }
            
            extendedProps.isRecurring = true;
            extendedProps.recurringRule = {
                freq: 'WEEKLY',
                days: selectedRecurringDays,
                end: recurringEndDateInput.value || null
            };
        } else {
            // Normal event
            if (time) {
                // Firebase ke liye Timestamp mein convert karein
                newEventData.start = new Date(`${date}T${time}:00`); 
                newEventData.allDay = false;
            } else {
                newEventData.start = new Date(date);
                newEventData.allDay = true;
            }
        }
        // --- Recurring Logic End ---

        // --- Save to Firebase ---
        try {
            // 'setDoc' ka istemaal karein (Add/Edit dono ke liye)
            const eventRef = doc(db, "schedule", newEventData.id);
            await setDoc(eventRef, newEventData);
            
            console.log("Event saved to Firebase!");
            closescheduleModal();
            // Calendar 'onSnapshot' ke kaaran apne aap update ho jaayega
        } catch (error) {
            console.error("Error saving event:", error);
            alert("Failed to save event.");
        }
    });
    
    // --- Delete Button ---
    if(deleteBtn) deleteBtn.addEventListener('click', async () => { // 'async' banaya
        const id = eventIdInput.value;
        if (id && confirm('Are you sure you want to delete this entry?')) {
            try {
                await deleteDoc(doc(db, "schedule", id));
               console.log("Event deleted from Firebase!");
               closescheduleModal();
                // Calendar 'onSnapshot' ke kaaran apne aap update ho jaayega
            } catch (error) {
                console.error("Error deleting event:", error);
               alert('Failed to delete event.');
            }
        }
    });

    // --- Feature: Route Optimization Button ---
    if (optimizeRouteBtn) {
        optimizeRouteBtn.addEventListener('click', async () => {
            const riderId = routeRiderSelect.value;
            if (!riderId) {
                alert('Please select a rider to optimize.');
                return;
           }
            
            // --- Naya Firebase Query Logic ---
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Aaj subah 12 baje
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1); // Kal subah 12 baje
           const todayDayOfWeek = String(today.getDay()); // Aaj ka din

            // 1. Aaj ke normal tasks dhoondein
            const q1 = query(collection(db, "schedule"),
                where("extendedProps.riderId", "==", riderId),
                where("start", ">=", today),
                where("start", "<", tomorrow)
            );
            
            // 2. Aaj ke recurring tasks dhoondein
            const q2 = query(collection(db, "schedule"),
                where("extendedProps.riderId", "==", riderId),
                where("daysOfWeek", "array-contains", todayDayOfWeek)
            );
            
            try {
                const [normalTasksSnapshot, recurringTasksSnapshot] = await Promise.all([
                    getDocs(q1),
                    getDocs(q2)
                ]);

                let tasksForToday = [];
                normalTasksSnapshot.forEach(doc => tasksForToday.push(doc.data()));
                recurringTasksSnapshot.forEach(doc => tasksForToday.push(doc.data()));

                if (tasksForToday.length === 0) {
                    alert('No tasks found for this rider today.');
                    return;
                }
                
                // Address waale tasks filter karein
                const addresses = tasksForToday
                    .map(task => task.extendedProps.customerAddress)
                    .filter(addr => addr); // Sirf woh task jinka address hai

                if (addresses.length === 0) {
                    alert('No tasks with valid addresses found for today.');
                 return;
                }

                // Google Maps URL banayein
                let mapsUrl = `https://www.google.com/maps/dir/`;
                mapsUrl += `${encodeURIComponent(YOUR_SHOP_ADDRESS)}/`; // Origin
               mapsUrl += addresses.map(addr => encodeURIComponent(addr)).join('/');
                mapsUrl += `/${encodeURIComponent(YOUR_SHOP_ADDRESS)}`; // Waapis shop par
                
                console.log("Opening Maps URL:", mapsUrl);
               window.open(mapsUrl, '_blank');
                
            } catch (error) {
                console.error("Error optimizing route: ", error);
                alert('Could not get tasks for optimization.');
            }
        });
    }
    // --- Event Listeners End ---

    
    // --- 6. LAZY LOAD INIT ---
    // Calendar ko tabhi load karein jab user 'schedule' link par click kare.
    const scheduleLink = document.querySelector('a[data-page="page-schedule"]');
    if (scheduleLink) {
        scheduleLink.addEventListener('click', () => {
            if (!calendar) {
                setTimeout(() => {
                    initCalendar();
                    // Dono rider dropdowns ko load karein
                    loadRidersIntoDropdown(eventRiderSelect);
                    loadRidersIntoDropdown(routeRiderSelect);
                }, 10);
            }
        }, { once: true }); // Yeh event sirf ek baar chalega
   }
    
    // Safety check: Agar user seedha schedule page par land hota hai
    setTimeout(() => {
        // Yahaan 'staffPage' ki jagah 'schedulePage' hona chahiye
      const schedulePage = document.getElementById('page-schedule');
        if (schedulePage && schedulePage.style.display !== 'none' && !calendar) {
             initCalendar();
             loadRidersIntoDropdown(eventRiderSelect);
             loadRidersIntoDropdown(routeRiderSelect);
        }
    }, 500);
//*==========================================*//
//*============== Schedule End =================*//
//*===========================================*//

//*==========================================*//
//*============== Cash Register Start =========*//
//*===========================================*//
    // --- 1. DOM ELEMENTS ---
    const summaryOpeningEl = document.getElementById('summary-opening');
    const summaryCashInEl = document.getElementById('summary-cash-in');
    const summaryCashOutEl = document.getElementById('summary-cash-out');
    const summaryClosingEl = document.getElementById('summary-closing');
    const cashLogBody = document.getElementById('cash-log-body');

    // Modals
    const openingModal = document.getElementById('opening-balance-modal');
    const cashInModal = document.getElementById('cash-in-modal');
    const cashOutModal = document.getElementById('cash-out-modal');
    
    // Modal Buttons
    const openOpeningBtn = document.getElementById('set-opening-balance-btn');
    const openCashInBtn = document.getElementById('add-cash-in-btn');
    const openCashOutBtn = document.getElementById('add-cash-out-btn');
    const closeModalBtns = document.querySelectorAll('.modal .close-btn');

    // Forms
    const openingForm = document.getElementById('opening-balance-form');
    const cashInForm = document.getElementById('cash-in-form');
    const cashOutForm = document.getElementById('cash-out-form');

    // --- 2. STATE (Demo Data) ---
    // Production mein yeh Firebase se aayega
    let cashLog = []; 
    // Example: { time: '10:30 AM', type: 'In', amount: 150.00, notes: 'Order INV-001' }

    // --- 3. MODAL HELPER FUNCTIONS ---
    function CashRegisteropenModal(modal) {
        if (modal) modal.style.display = 'block';
    }
    function closeModal(modal) {
        if (modal) modal.style.display = 'none';
    }

    // --- 4. EVENT LISTENERS (Buttons) ---
    if (openOpeningBtn) openOpeningBtn.addEventListener('click', () => CashRegisteropenModal(openingModal));
    if (openCashInBtn) openCashInBtn.addEventListener('click', () => CashRegisteropenModal(cashInModal));
    if (openCashOutBtn) openCashOutBtn.addEventListener('click', () => CashRegisteropenModal(cashOutModal));

    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const modalId = btn.getAttribute('data-modal');
            closeModal(document.getElementById(modalId));
        });
    });

    // Close modal on outside click
    window.addEventListener('click', (e) => {
        if (e.target == openingModal) closeModal(openingModal);
        if (e.target == cashInModal) closeModal(cashInModal);
        if (e.target == cashOutModal) closeModal(cashOutModal);
    });

    // --- 5. EVENT LISTENERS (Forms) ---
    if (openingForm) {
        openingForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('form-opening-amount').value);
            if (isNaN(amount)) return;
            
            // Check if opening balance already set
            const existing = cashLog.find(log => log.type === 'Opening');
            if (existing) {
                alert('Opening balance is already set. You can add more cash using "Add Cash In".');
                return;
            }

            addTransaction('Opening', amount, 'Opening Balance');
            closeModal(openingModal);
            openingForm.reset();
        });
    }

    if (cashInForm) {
        cashInForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('form-cash-in-amount').value);
            const notes = document.getElementById('form-cash-in-notes').value;
            if (isNaN(amount) || amount <= 0) return;

            addTransaction('In', amount, notes);
            closeModal(cashInModal);
            cashInForm.reset();
        });
    }
    
    if (cashOutForm) {
        cashOutForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('form-cash-out-amount').value);
            const notes = document.getElementById('form-cash-out-notes').value;
            if (isNaN(amount) || amount <= 0) return;

            addTransaction('Out', amount, notes);
            closeModal(cashOutModal);
            cashOutForm.reset();
        });
    }
    
    // --- 6. CORE LOGIC ---
    function addTransaction(type, amount, notes) {
        const transaction = {
            id: `txn_${Date.now()}`,
            time: new Date(),
            type: type, // 'Opening', 'In', 'Out'
            amount: amount,
            notes: notes || 'N/A'
        };

        /* * =============================================
         * FIREBASE CODE (SAVE TRANSACTION)
         * =============================================
         * const today = new Date().toISOString().split('T')[0]; // '2025-10-22'
         * const logRef = doc(db, 'cashRegister', today, 'logs', transaction.id);
         * setDoc(logRef, transaction).then(() => {
         * console.log('Transaction saved');
         * }).catch(e => console.error(e));
         */

        // Demo logic: Add to local array
        cashLog.push(transaction);
        
        // Update UI
        updateUI();
    }
    
    function updateUI() {
        renderCashLog();
        updateSummary();
    }
    
    function renderCashLog() {
        if (!cashLogBody) return;
        cashLogBody.innerHTML = ''; // Clear table
        
        // Sort by time
        const sortedLog = cashLog.sort((a, b) => a.time - b.time);

        if (sortedLog.length === 0) {
            cashLogBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No transactions for today.</td></tr>';
            return;
        }

        sortedLog.forEach(log => {
            const row = document.createElement('tr');
            
            // Format time (e.g., 07:45 AM)
            const timeString = log.time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            let amountCell = '';
            if (log.type === 'In' || log.type === 'Opening') {
                amountCell = `<td style="color: var(--success-green); font-weight: 500;">+ ₹${log.amount.toFixed(2)}</td>`;
            } else if (log.type === 'Out') {
                amountCell = `<td style="color: var(--primary-red); font-weight: 500;">- ₹${log.amount.toFixed(2)}</td>`;
            }

            row.innerHTML = `
                <td>${timeString}</td>
                <td>${log.type}</td>
                ${amountCell}
                <td>${log.notes}</td>
            `;
            cashLogBody.appendChild(row);
        });
    }

    function updateSummary() {
        if (!summaryOpeningEl) return;

        let opening = 0;
        let cashIn = 0;
        let cashOut = 0;

        cashLog.forEach(log => {
            if (log.type === 'Opening') {
                opening += log.amount;
            } else if (log.type === 'In') {
                cashIn += log.amount;
            } else if (log.type === 'Out') {
                cashOut += log.amount;
            }
        });

        const closing = (opening + cashIn) - cashOut;

        summaryOpeningEl.textContent = `₹${opening.toFixed(2)}`;
        summaryCashInEl.textContent = `₹${cashIn.toFixed(2)}`;
        summaryCashOutEl.textContent = `₹${cashOut.toFixed(2)}`;
        summaryClosingEl.textContent = `₹${closing.toFixed(2)}`;
    }

    // --- 7. INITIALIZATION ---
    function initCashRegister() {
        /*
         * =============================================
         * FIREBASE CODE (LOAD TODAY'S LOGS)
         * =============================================
         * const today = new Date().toISOString().split('T')[0];
         * const logsCol = collection(db, 'cashRegister', today, 'logs');
         * const q = query(logsCol, orderBy('time', 'asc'));
         * * onSnapshot(q, (snapshot) => {
         * cashLog = []; // Clear local array
         * snapshot.forEach(doc => {
         * const data = doc.data();
         * // Convert Firebase Timestamp back to JS Date
         * data.time = data.time.toDate(); 
         * cashLog.push(data);
         * });
         * updateUI(); // Update UI with Firebase data
         * });
         */
        
        // Demo logic: Just update UI with empty array
        updateUI();
    }

    // Run when the app loads (Called from DOMContentLoaded)
    // initCashRegister(); // <-- YEH FIX 6 HAI: Is line ko yahaan se hata diya hai
//*==========================================*//
//*============== Cash Register End ============*//
//*==========================================*//

//*==========================================*//
//*============== Coustomer Start ==================*//
//*===========================================*//
 // --- 1. DOM ELEMENTS ---
    
    // YEH BADLAAV KIYA GAYA HAI
    const customersTableBody = document.getElementById('customers-list-body');
    const customerSearchInput = document.getElementById('customer-search');
    const customerModal = document.getElementById('customer-modal');

    const customerModalTitle = document.getElementById('modal-title');
    const addCustomerBtn = document.getElementById('add-customer-btn');
    const customerModalCloseBtn = document.getElementById('modal-close-btn');
    const customerForm = document.getElementById('customer-form');
    
    // --- 2. MODAL FUNCTIONS ---
    function openModal(mode = 'add', customer = null) {
        if (mode === 'add') {
            customerModalTitle.textContent = 'Add New Customer';
            customerForm.reset();
            document.getElementById('customer-id').value = '';
        } else if (mode === 'edit' && customer) {
            customerModalTitle.textContent = 'Edit Customer';
            document.getElementById('customer-id').value = customer.id;
            document.getElementById('form-customer-name').value = customer.name;
            document.getElementById('form-customer-phone').value = customer.phone;
            document.getElementById('form-customer-address').value = customer.address || '';
        }
        // YEH BADLAAV KIYA GAYA HAI
        customerModal.style.display = 'block';
    }

    function closeCustomerModal(){
        // YEH BADLAAV KIYA GAYA HAI
        customerModal.style.display = 'none';
    }

    // --- 3. MODAL EVENTS ---
    addCustomerBtn.addEventListener('click', () => openModal('add'));
    if (customerModalCloseBtn) { // Check karein ki button hai
    customerModalCloseBtn.addEventListener('click', closeCustomerModal);
}
    window.addEventListener('click', (e) => {
        // YEH BADLAAV KIYA GAYA HAI
        if (e.target == customerModal) {
            closeCustomerModal();
        }
    });

    // --- 4. LOAD CUSTOMERS (FROM FIREBASE) ---
    function loadCustomers() {
        console.log("Loading customers...");
        // YEH BADLAAV KIYA GAYA HAI
        customersTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading customers...</td></tr>';
        
        /*
         * =============================================
         * FIREBASE CODE (LOAD CUSTOMERS)
         * =============================================
         *
         * const customersQuery = query(collection(db, 'customers'), orderBy('name'));
         * * getDocs(customersQuery).then(snapshot => {
         * if (snapshot.empty) {
         * customersTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No customers found.</td></tr>';
         * return;
         * }
         * * customersTableBody.innerHTML = ''; // Clear loader
         * snapshot.forEach(doc => {
         * const customer = { id: doc.id, ...doc.data() };
         * renderCustomerRow(customer);
         * });
         * });
         */
        
        // --- डेमो डेटा (Firebase के बिना) ---
        // YEH BADLAAV KIYA GAYA HAI
        customersTableBody.innerHTML = ''; // Clear loader
        const demoData = [
            { id: 'c1', name: 'Sarthak Kumar', phone: '9876543210', totalOrders: 5, address: '123 ABC St' },
            { id: 'c2', name: 'Neha Singh', phone: '9876543211', totalOrders: 2, address: '456 XYZ Rd' },
            { id: 'c3', name: 'Rohan Verma', phone: '9876543212', totalOrders: 8, address: '789 LMN Ave' }
        ];
        demoData.forEach(renderCustomerRow);
    }
    
    // Helper function to render a row
    function renderCustomerRow(customer) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${customer.name}</td>
            <td>${customer.phone}</td>
            <td>${customer.totalOrders || 0}</td>
            <td>
                <button class="btn btn-secondary btn-edit" style="padding: 5px 10px;">Edit</button>
            </td>
        `;
        // Add edit button functionality
        row.querySelector('.btn-edit').addEventListener('click', () => {
            openModal('edit', customer);
        });
        // YEH BADLAAV KIYA GAYA HAI
        customersTableBody.appendChild(row);
    }

    // --- 5. SAVE CUSTOMER (FORM SUBMIT) ---
    customerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const customerData = {
            name: document.getElementById('form-customer-name').value,
            phone: document.getElementById('form-customer-phone').value,
            address: document.getElementById('form-customer-address').value,
        };
        const customerId = document.getElementById('customer-id').value;

        if (customerId) {
            // --- UPDATE EXISTING CUSTOMER ---
            console.log("Updating customer (Send to Firebase):", customerId, customerData);
            /*
             * =============================================
             * FIREBASE CODE (UPDATE CUSTOMER)
             * =============================================
             * const customerRef = doc(db, 'customers', customerId);
             * updateDoc(customerRef, customerData).then(() => {
             * alert("Customer updated successfully!");
             * closeCustomerModal();
             * loadCustomers(); // Refresh list
             * }).catch(e => console.error("Error updating: ", e));
             */
            
        } else {
            // --- ADD NEW CUSTOMER ---
            console.log("Adding new customer (Send to Firebase):", customerData);
            /*
             * =============================================
             * FIREBASE CODE (ADD CUSTOMER)
             * =============================================
             * // Add `createdAt` and `totalOrders: 0`
             * const dataToSave = { ...customerData, totalOrders: 0, createdAt: serverTimestamp() };
             * addDoc(collection(db, 'customers'), dataToSave).then(() => {
             * alert("Customer added successfully!");
             * closeCustomerModal();
             * loadCustomers(); // Refresh list
             * }).catch(e => console.error("Error adding: ", e));
             */
        }
        
        // --- Demo (Firebase के बिना) ---
        alert("Customer saved successfully! (Demo)");
        closeCustomerModal();
        // (In a real app, you would reload the list)
    });
    
    // --- 6. SEARCH (Simple JS filter) ---
    // YEH BADLAAV KIYA GAYA HAI
    customerSearchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        // YEH BADLAAV KIYA GAYA HAI
        const rows = customersTableBody.getElementsByTagName('tr');
        for (let row of rows) {
            const rowText = row.textContent.toLowerCase();
            if (rowText.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        }
    });

    // --- INIT ---
    // loadCustomers(); // <-- YEH FIX 6 HAI: Is line ko yahaan se hata diya hai
//*==========================================*//
//*============== Coustomer End ==================*//
//*===========================================*//

//*==========================================*//
//*============== Staff Management Start ======*//
//*===========================================*//
// --- 1. DOM ELEMENTS ---
const staffPage = document.getElementById('page-staff'); // Check karne ke liye ki hum staff page par hain
const staffListBody = document.getElementById('staff-list-body');
const openStaffModalBtn = document.getElementById('add-staff-btn');
const staffModal = document.getElementById('staff-modal');
const staffModalTitle = document.getElementById('staff-modal-title');
const closeStaffModalBtn = staffModal ? staffModal.querySelector('.close-btn[data-modal="staff-modal"]') : null;
const staffForm = document.getElementById('staff-form');
const staffIdInput = document.getElementById('staff-id');
const staffNameInput = document.getElementById('staff-name');

// --- 2. HELPER FUNCTIONS ---
function openStaffModal(mode = 'add', rider = null) {
    if (!staffModal) return;
    staffForm.reset();
    staffIdInput.value = ''; // Clear ID

    if (mode === 'add') {
        staffModalTitle.textContent = 'Add New Rider';
    } else if (mode === 'edit' && rider) {
        staffModalTitle.textContent = 'Edit Rider';
        staffIdInput.value = rider.id;
        staffNameInput.value = rider.name;
    }
    staffModal.style.display = 'block';
}

function closeStaffModal() {
    if (staffModal) staffModal.style.display = 'none';
}

// --- 3. LOAD & RENDER STAFF LIST ---
function loadStaffList() {
    if (!staffListBody) return;
    
    // 'riders' collection ko sunein
    const q = query(collection(db, "riders"), orderBy("name")); // Naam se sort karein
    
    onSnapshot(q, (snapshot) => {
        staffListBody.innerHTML = ''; // List khaali karein
        
        if (snapshot.empty) {
            staffListBody.innerHTML = '<tr><td colspan="2" style="text-align: center;">No riders added yet.</td></tr>';
            return;
        }

        snapshot.forEach(doc => {
            const rider = { id: doc.id, ...doc.data() };
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${rider.name}</td>
                <td style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary btn-edit-staff" data-id="${rider.id}" style="padding: 5px 10px;">
                        <i class="fa-solid fa-pencil"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-delete-staff" data-id="${rider.id}" data-name="${rider.name}" style="padding: 5px 10px; background-color: var(--danger-red); color: white;">
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                </td>
            `;
            staffListBody.appendChild(row);
        });
    });
}

// --- 4. SAVE/UPDATE STAFF ---
async function handleStaffFormSubmit(e) {
    e.preventDefault();
    if (!staffNameInput.value) return;

    const riderId = staffIdInput.value;
    const riderName = staffNameInput.value;
    
    // Data object banayein
    const riderData = {
        name: riderName
        // Yahaan phone number etc. bhi add kar sakte hain
    };

    try {
        let docRef;
        if (riderId) {
            // EDIT MODE: Puraane document ko update karein
            docRef = doc(db, "riders", riderId);
            await updateDoc(docRef, riderData);
            alert('Rider updated successfully!');
        } else {
            // ADD MODE: Naya document banayein (Firebase ID apne aap banayega)
            docRef = await addDoc(collection(db, "riders"), riderData);
            alert('Rider added successfully!');
        }
        closeStaffModal();
    } catch (error) {
        console.error("Error saving rider: ", error);
        alert('Failed to save rider.');
    }
}

// --- 5. DELETE STAFF ---
async function handleDeleteStaff(riderId, riderName) {
    if (!riderId || !riderName) return;
    
    if (confirm(`Are you sure you want to delete rider "${riderName}"?`)) {
        try {
            await deleteDoc(doc(db, "riders", riderId));
            alert('Rider deleted successfully!');
            // List apne aap update ho jaayegi (onSnapshot ke kaaran)
        } catch (error) {
            console.error("Error deleting rider: ", error);
            alert('Failed to delete rider.');
        }
    }
}


// --- 6. EVENT LISTENERS SETUP ---
function setupStaffEventListeners() {
    if (!staffPage) return; // Agar staff page nahin hai toh setup na karein

    // Modal buttons
    if (openStaffModalBtn) {
        openStaffModalBtn.addEventListener('click', () => openStaffModal('add'));
    }
    if (closeStaffModalBtn) {
        closeStaffModalBtn.addEventListener('click', closeStaffModal);
    }
    window.addEventListener('click', (e) => {
        if (e.target == staffModal) closeStaffModal();
    });

    // Form submit
    if (staffForm) {
        staffForm.addEventListener('submit', handleStaffFormSubmit);
    }

    // Edit/Delete buttons (Event Delegation)
    if (staffListBody) {
        staffListBody.addEventListener('click', (e) => {
            const editButton = e.target.closest('.btn-edit-staff');
            const deleteButton = e.target.closest('.btn-delete-staff');

            if (editButton) {
                const riderId = editButton.dataset.id;
                // Rider ka data Firebase se fetch karna hoga (ya onSnapshot waale data se)
                // Abhi ke liye, hum sirf ID aur naam pass kar rahe hain (agar list se mil jaaye)
                const riderName = editButton.closest('tr').querySelector('td').textContent; // Simple tareeka
                openStaffModal('edit', { id: riderId, name: riderName });
            } 
            else if (deleteButton) {
                const riderId = deleteButton.dataset.id;
                const riderName = deleteButton.dataset.name;
                handleDeleteStaff(riderId, riderName);
            }
        });
    }
}


// --- 7. INITIALIZATION (Load only when Staff page is active) ---
const staffLink = document.querySelector('a[data-page="page-staff"]');
if (staffLink) {
    staffLink.addEventListener('click', () => {
        // Staff page par aate hi list load karein
        // Pehle listeners setup karein, phir data load karein
        setupStaffEventListeners(); 
        loadStaffList();
    });
}

// Safety check agar user seedha Staff page par land hota hai
setTimeout(() => {
    if (staffPage && staffPage.style.display !== 'none') {
        setupStaffEventListeners();
        loadStaffList();
    }
}, 500); // Thoda delay

//*==========================================*//
//*============== Staff Management End ========*//
//*===========================================*//
    </script>
  
<script src="js/main.js" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>
</body>
</html>




